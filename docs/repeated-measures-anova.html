<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Repeated Measures ANOVA | Power Analysis with Superpower</title>
  <meta name="description" content="This is a book describing the capabilities of the Superpower R package." />
  <meta name="generator" content="bookdown 0.13 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Repeated Measures ANOVA | Power Analysis with Superpower" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a book describing the capabilities of the Superpower R package." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Repeated Measures ANOVA | Power Analysis with Superpower" />
  
  <meta name="twitter:description" content="This is a book describing the capabilities of the Superpower R package." />
  

<meta name="author" content="Aaron R. Caldwell &amp; DaniÃ«l Lakens" />


<meta name="date" content="2019-09-25" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="one-way-anova.html"/>
<link rel="next" href="mixed-anova.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Superpower</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="the-experimental-design.html"><a href="the-experimental-design.html"><i class="fa fa-check"></i><b>1</b> The Experimental Design</a><ul>
<li class="chapter" data-level="1.1" data-path="the-experimental-design.html"><a href="the-experimental-design.html#anova_design-function"><i class="fa fa-check"></i><b>1.1</b> ANOVA_design function</a><ul>
<li class="chapter" data-level="1.1.1" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-design-using-design"><i class="fa fa-check"></i><b>1.1.1</b> Specifying the design using <code>design</code></a></li>
<li class="chapter" data-level="1.1.2" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-means-using-mu"><i class="fa fa-check"></i><b>1.1.2</b> Specifying the means using <code>mu</code></a></li>
<li class="chapter" data-level="1.1.3" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-label-names"><i class="fa fa-check"></i><b>1.1.3</b> Specifying label names</a></li>
<li class="chapter" data-level="1.1.4" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-correlation"><i class="fa fa-check"></i><b>1.1.4</b> Specifying the correlation</a></li>
<li class="chapter" data-level="1.1.5" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-sample-size"><i class="fa fa-check"></i><b>1.1.5</b> Specifying the sample size</a></li>
<li class="chapter" data-level="1.1.6" data-path="the-experimental-design.html"><a href="the-experimental-design.html#specifying-the-standard-deviation"><i class="fa fa-check"></i><b>1.1.6</b> Specifying the standard deviation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="one-way-anova.html"><a href="one-way-anova.html"><i class="fa fa-check"></i><b>2</b> One-Way ANOVA</a><ul>
<li class="chapter" data-level="2.1" data-path="one-way-anova.html"><a href="one-way-anova.html#part-1"><i class="fa fa-check"></i><b>2.1</b> Part 1</a><ul>
<li class="chapter" data-level="2.1.1" data-path="one-way-anova.html"><a href="one-way-anova.html#two-conditions"><i class="fa fa-check"></i><b>2.1.1</b> Two conditions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="one-way-anova.html"><a href="one-way-anova.html#part-2"><i class="fa fa-check"></i><b>2.2</b> Part 2</a><ul>
<li class="chapter" data-level="2.2.1" data-path="one-way-anova.html"><a href="one-way-anova.html#three-conditions"><i class="fa fa-check"></i><b>2.2.1</b> Three conditions</a></li>
<li class="chapter" data-level="2.2.2" data-path="one-way-anova.html"><a href="one-way-anova.html#power-for-simple-effects"><i class="fa fa-check"></i><b>2.2.2</b> Power for simple effects</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="one-way-anova.html"><a href="one-way-anova.html#part-3"><i class="fa fa-check"></i><b>2.3</b> Part 3</a><ul>
<li class="chapter" data-level="2.3.1" data-path="one-way-anova.html"><a href="one-way-anova.html#three-conditions-replication"><i class="fa fa-check"></i><b>2.3.1</b> Three conditions replication</a></li>
<li class="chapter" data-level="2.3.2" data-path="one-way-anova.html"><a href="one-way-anova.html#variation-1"><i class="fa fa-check"></i><b>2.3.2</b> Variation 1</a></li>
<li class="chapter" data-level="2.3.3" data-path="one-way-anova.html"><a href="one-way-anova.html#three-conditions-replication-1"><i class="fa fa-check"></i><b>2.3.3</b> Three conditions replication</a></li>
<li class="chapter" data-level="2.3.4" data-path="one-way-anova.html"><a href="one-way-anova.html#variation-2"><i class="fa fa-check"></i><b>2.3.4</b> Variation 2</a></li>
<li class="chapter" data-level="2.3.5" data-path="one-way-anova.html"><a href="one-way-anova.html#three-conditions-replication-2"><i class="fa fa-check"></i><b>2.3.5</b> Three conditions replication</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="one-way-anova.html"><a href="one-way-anova.html#effect-size-estimates-for-one-way-anova"><i class="fa fa-check"></i><b>2.4</b> Effect Size Estimates for One-Way ANOVA</a><ul>
<li class="chapter" data-level="2.4.1" data-path="one-way-anova.html"><a href="one-way-anova.html#three-conditions-small-effect-size"><i class="fa fa-check"></i><b>2.4.1</b> Three conditions, small effect size</a></li>
<li class="chapter" data-level="2.4.2" data-path="one-way-anova.html"><a href="one-way-anova.html#four-conditions-medium-effect-size"><i class="fa fa-check"></i><b>2.4.2</b> Four conditions, medium effect size</a></li>
<li class="chapter" data-level="2.4.3" data-path="one-way-anova.html"><a href="one-way-anova.html#two-conditions-large-effect-size"><i class="fa fa-check"></i><b>2.4.3</b> Two conditions, large effect size</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html"><i class="fa fa-check"></i><b>3</b> Repeated Measures ANOVA</a><ul>
<li class="chapter" data-level="3.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-1-1"><i class="fa fa-check"></i><b>3.1</b> Part 1</a><ul>
<li class="chapter" data-level="3.1.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#two-conditions-medium-effect-size"><i class="fa fa-check"></i><b>3.1.1</b> Two conditions, medium effect size</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-2-1"><i class="fa fa-check"></i><b>3.2</b> Part 2</a><ul>
<li class="chapter" data-level="3.2.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#the-relation-between-cohens-f-and-cohens-d"><i class="fa fa-check"></i><b>3.2.1</b> The relation between Cohenâs f and Cohenâs d</a></li>
<li class="chapter" data-level="3.2.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#three-within-conditions-medium-effect-size"><i class="fa fa-check"></i><b>3.2.2</b> Three within conditions, medium effect size</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-3-1"><i class="fa fa-check"></i><b>3.3</b> Part 3</a><ul>
<li class="chapter" data-level="3.3.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#reproducing-brysbaerts-examples"><i class="fa fa-check"></i><b>3.3.1</b> Reproducing Brysbaertâs Examples</a></li>
<li class="chapter" data-level="3.3.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#reproducing-brysbaert-variation-1-changing-correlation"><i class="fa fa-check"></i><b>3.3.2</b> Reproducing Brysbaert Variation 1: Changing Correlation</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-4"><i class="fa fa-check"></i><b>3.4</b> Part 4</a><ul>
<li class="chapter" data-level="3.4.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#x2-anova-within-within-design"><i class="fa fa-check"></i><b>3.4.1</b> 2x2 ANOVA, within-within design</a></li>
<li class="chapter" data-level="3.4.2" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#examine-variation-of-means-and-correlation"><i class="fa fa-check"></i><b>3.4.2</b> Examine variation of means and correlation</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#part-5"><i class="fa fa-check"></i><b>3.5</b> Part 5</a><ul>
<li class="chapter" data-level="3.5.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#x2-anova-within-design"><i class="fa fa-check"></i><b>3.5.1</b> 2x2 ANOVA, within design</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#multivariate-anova-manova"><i class="fa fa-check"></i><b>3.6</b> Multivariate ANOVA (MANOVA)</a></li>
<li class="chapter" data-level="3.7" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#sphericity-assumption"><i class="fa fa-check"></i><b>3.7</b> Sphericity Assumption</a><ul>
<li class="chapter" data-level="3.7.1" data-path="repeated-measures-anova.html"><a href="repeated-measures-anova.html#manova-or-sphericity-adjustment"><i class="fa fa-check"></i><b>3.7.1</b> MANOVA or Sphericity Adjustment?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mixed-anova.html"><a href="mixed-anova.html"><i class="fa fa-check"></i><b>4</b> Mixed ANOVA</a><ul>
<li class="chapter" data-level="4.1" data-path="mixed-anova.html"><a href="mixed-anova.html#x2-anova-within-between-design"><i class="fa fa-check"></i><b>4.1</b> 2x2 ANOVA, within-between design</a><ul>
<li class="chapter" data-level="4.1.1" data-path="mixed-anova.html"><a href="mixed-anova.html#two-by-two-anova-within-between-design-variation-1"><i class="fa fa-check"></i><b>4.1.1</b> Two by two ANOVA, within-between design Variation 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="power-for-three-way-interactions.html"><a href="power-for-three-way-interactions.html"><i class="fa fa-check"></i><b>5</b> Power for Three-way Interactions</a></li>
<li class="chapter" data-level="6" data-path="the-no-way-interactions.html"><a href="the-no-way-interactions.html"><i class="fa fa-check"></i><b>6</b> The âNo-Wayâ Interactions</a></li>
<li class="chapter" data-level="7" data-path="effect-of-varying-designs-on-power.html"><a href="effect-of-varying-designs-on-power.html"><i class="fa fa-check"></i><b>7</b> Effect of Varying Designs on Power</a><ul>
<li class="chapter" data-level="7.1" data-path="effect-of-varying-designs-on-power.html"><a href="effect-of-varying-designs-on-power.html#within-designs"><i class="fa fa-check"></i><b>7.1</b> Within Designs</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="error-control-in-exploratory-anova.html"><a href="error-control-in-exploratory-anova.html"><i class="fa fa-check"></i><b>8</b> Error Control in Exploratory ANOVA</a></li>
<li class="chapter" data-level="9" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html"><i class="fa fa-check"></i><b>9</b> Analytic Power Functions</a><ul>
<li class="chapter" data-level="9.1" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html#one-way-between-subjects-anova"><i class="fa fa-check"></i><b>9.1</b> One-Way Between Subjects ANOVA</a></li>
<li class="chapter" data-level="9.2" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html#two-way-between-subject-interaction"><i class="fa fa-check"></i><b>9.2</b> Two-way Between Subject Interaction</a></li>
<li class="chapter" data-level="9.3" data-path="analytic-power-functions.html"><a href="analytic-power-functions.html#x3-between-subject-anova"><i class="fa fa-check"></i><b>9.3</b> 3x3 Between Subject ANOVA</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="power-curve.html"><a href="power-curve.html"><i class="fa fa-check"></i><b>10</b> Power Curve</a><ul>
<li class="chapter" data-level="10.1" data-path="power-curve.html"><a href="power-curve.html#explore-increase-in-effect-size-for-moderated-interactions."><i class="fa fa-check"></i><b>10.1</b> Explore increase in effect size for moderated interactions.</a></li>
<li class="chapter" data-level="10.2" data-path="power-curve.html"><a href="power-curve.html#explore-increase-in-effect-size-for-cross-over-interactions."><i class="fa fa-check"></i><b>10.2</b> Explore increase in effect size for cross-over interactions.</a></li>
<li class="chapter" data-level="10.3" data-path="power-curve.html"><a href="power-curve.html#explore-increase-in-correlation-in-moderated-interactions."><i class="fa fa-check"></i><b>10.3</b> Explore increase in correlation in moderated interactions.</a></li>
<li class="chapter" data-level="10.4" data-path="power-curve.html"><a href="power-curve.html#increasing-correlation-in-on-factor-decreases-power-in-second-factor"><i class="fa fa-check"></i><b>10.4</b> Increasing correlation in on factor decreases power in second factor</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html"><i class="fa fa-check"></i>Appendix 1: Direct Comparison to pwr2ppl</a><ul>
<li class="chapter" data-level="10.5" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#examples-from-chapter-5"><i class="fa fa-check"></i><b>10.5</b> Examples from Chapter 5</a><ul>
<li class="chapter" data-level="10.5.1" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-5.15.2"><i class="fa fa-check"></i><b>10.5.1</b> Example 5.1/5.2</a></li>
<li class="chapter" data-level="10.5.2" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-5.3"><i class="fa fa-check"></i><b>10.5.2</b> Example 5.3</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#examples-from-chapter-6"><i class="fa fa-check"></i><b>10.6</b> Examples from Chapter 6</a><ul>
<li class="chapter" data-level="10.6.1" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-table-6.2"><i class="fa fa-check"></i><b>10.6.1</b> Example from Table 6.2</a></li>
<li class="chapter" data-level="10.6.2" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-table-6.6"><i class="fa fa-check"></i><b>10.6.2</b> Example from Table 6.6</a></li>
<li class="chapter" data-level="10.6.3" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-table-6.8"><i class="fa fa-check"></i><b>10.6.3</b> Example from Table 6.8</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#example-from-chapter-7"><i class="fa fa-check"></i><b>10.7</b> Example from Chapter 7</a><ul>
<li class="chapter" data-level="10.7.1" data-path="appendix-1-direct-comparison-to-pwr2ppl.html"><a href="appendix-1-direct-comparison-to-pwr2ppl.html#from-table-7.2"><i class="fa fa-check"></i><b>10.7.1</b> From Table 7.2</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="appendix-2-direct-comparison-to-morepower.html"><a href="appendix-2-direct-comparison-to-morepower.html"><i class="fa fa-check"></i>Appendix 2: Direct Comparison to MOREpower</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Power Analysis with Superpower</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="repeated-measures-anova" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Repeated Measures ANOVA</h1>
<div id="part-1-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Part 1</h2>
<p>In a repeated measures design multiple observations are collected from the same participants. In the simplest case, where there are two repeated observations, a repeated measures ANOVA equals a dependent or paired <em>t</em>-test. The difference compared to a between subject design is that repeated measures can be correlated, and in psychology, they often are. Letâs first explore the impact of this correlation on the power of a repeated measures ANOVA.</p>
<div id="two-conditions-medium-effect-size" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Two conditions, medium effect size</h3>
<p>To illustrate the effect of correated observations, we start by simulating data for a medium effect size for a dependent (or paired, or within-subject) <em>t</em>-test. Letâs first look at <span class="citation">Faul et al. (<a href="#ref-faul2007g">2007</a>)</span>. If we want to perform an a-priori power analysis, we are asked to fill in the effect size dz. As <span class="citation">Cohen (<a href="#ref-cohen1988spa">1988</a>)</span> writes, âThe Z subscript is used to emphasize the fact that our raw score unit is no longer X or Y, but Zâ, where Z are the difference scores of X-Y.</p>
<p><img src="screenshots/gpower_9.png" /></p>
<p>Within designs can have greater power to detect differences than between designs because the values are correlated, and a within design requires less participants because each participant provides multiple observations. One difference between an independent <em>t</em>-test and a dependent <em>t</em>-test is that an independent <em>t</em>-test has 2(n-1) degrees of freedom, while a dependent <em>t</em>-test has (n-1) degrees of freedom. The sample size needed in a two-group within-design (NW) relative to the sample needed in two-group between-designs (NB), assuming normal distributions, and ignoring the difference in degrees of freedom between the two types of tests, is (from <span class="citation">Maxwell et al. (<a href="#ref-maxwell_designing_2004">2004</a>)</span>, p.Â 561, formula 45):</p>
<p><span class="math inline">\(N_{W}=\frac{N_{B}(1-\rho)}{2}\)</span></p>
<p>The division by 2 in the equation is due to the fact that in a two-condition within design every participant provides two data-points. The extent to which this reduces the sample size compared to a between-subject design depends on the correlation (<em>r</em>) between the two dependent variables, as indicated by the <code>1-r</code> part of the equation. If the correlation is 0, a within-subject design needs half as many participants as a between-subject design (e.g., 64 instead 128 participants), simply because every participants provides 2 datapoints. The higher the correlation, the larger the relative benefit of within designs, and whenever the correlation is negative (up to -1) the relative benefit disappears.</p>
<p>Whereas in an independent <em>t</em>-test the two observations are uncorrelated, in a within design the observations are correlated. This has an effect on the standard deviation of the difference scores. In turn, because the standardized effect size is the mean difference divided by the standard deviation of the difference scores, the correlation has an effect on the standardized mean difference in a within design, Cohenâs dz. The relation, as Cohen (1988, formula 2.3.7) explains, is:</p>
<p><span class="math inline">\(\sigma_{z}=\sigma\sqrt{2(1-\rho)}\)</span></p>
<p>Therefore, the relation between dz and d is <span class="math inline">\(\sqrt{2(1-\rho)}\)</span>. A given difference between population means for matched (dependent) samples is standardized by a value which is <span class="math inline">\(\sqrt{2(1-\rho)}\)</span> as large as would be the case were they independent. If we enter a correlation of 0.5 in the formula, we get <span class="math inline">\(\sqrt{2(0.5)}=1\)</span>. In other words, when the correlation is 0.5, d = dz. When there is a strong correlation between dependent variables, for example r = 0.9, we get <span class="math inline">\(d=d_{z}\sqrt{2(1-0.9)}\)</span>, and a dz of 1 would be a d = 0.45. Reversely, <span class="math inline">\(d_{z}=\frac{d}{\sqrt{2(1-r)}}\)</span>, so with a r = 0.9, a d of 1 would be a dz = 2.24. Some consider this increase in dz compared to d when observations are strongly correlated an âinflationâ when estimating effect sizes, but since the reduction in the standard deviation of the difference scores due to the correlation makes it easier to distinguish signal from noise in a hypothesis test, it leads to a clear power benefit.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1"><span class="co"># Check sample size formula Maxwell</span></a>
<a class="sourceLine" id="cb102-2" title="2"><span class="co"># Power is pretty similar with n/2, same d (assuming r = 0.5). </span></a>
<a class="sourceLine" id="cb102-3" title="3"><span class="co"># Small differences due to df = 2(n-1) vs df = n-1</span></a>
<a class="sourceLine" id="cb102-4" title="4"><span class="kw">pwr.t.test</span>(<span class="dt">d =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb102-5" title="5">           <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">2000</span>, <span class="dv">4000</span>, <span class="dv">8000</span>),</a>
<a class="sourceLine" id="cb102-6" title="6">           <span class="dt">sig.level =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb102-7" title="7">           <span class="dt">type =</span> <span class="st">&quot;two.sample&quot;</span>,</a>
<a class="sourceLine" id="cb102-8" title="8">           <span class="dt">alternative =</span> <span class="st">&quot;two.sided&quot;</span>)</a></code></pre></div>
<pre><code>## 
##      Two-sample t test power calculation 
## 
##               n = 2000, 4000, 8000
##               d = 0.05
##       sig.level = 0.05
##           power = 0.3524674, 0.6086764, 0.8853424
##     alternative = two.sided
## 
## NOTE: n is number in *each* group</code></pre>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1"><span class="kw">pwr.t.test</span>(<span class="dt">d =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb104-2" title="2">           <span class="dt">n =</span> <span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">4000</span>),</a>
<a class="sourceLine" id="cb104-3" title="3">           <span class="dt">sig.level =</span> <span class="fl">0.05</span>,</a>
<a class="sourceLine" id="cb104-4" title="4">           <span class="dt">type =</span> <span class="st">&quot;paired&quot;</span>,</a>
<a class="sourceLine" id="cb104-5" title="5">           <span class="dt">alternative =</span> <span class="st">&quot;two.sided&quot;</span>)</a></code></pre></div>
<pre><code>## 
##      Paired t test power calculation 
## 
##               n = 1000, 2000, 4000
##               d = 0.05
##       sig.level = 0.05
##           power = 0.3520450, 0.6083669, 0.8852320
##     alternative = two.sided
## 
## NOTE: n is number of *pairs*</code></pre>
<p>There is no equivalent âfzâ for Cohenâs <em>f</em> for a within subject ANOVA. For two groups, we can directly compute Cohenâs <em>f</em> from Cohenâs d for two groups, as <span class="citation">Cohen (<a href="#ref-cohen1988spa">1988</a>)</span> describes, because f = 1/2d. For a d = 0.5, f = 0.25. In Gpower we can run a 2 group within-subject power analysis for ANOVA. We plan for 80% power, and reproduce the anaysis above for the dependent <em>t</em>-test. This works because the correlation is set to 0.5, when d = dz, and thus the transformation of f=1/2d works.</p>
<p><img src="screenshots/gpower_1.png" /></p>
<p>If we change the correlation to 0.7 and keep all other settings the same, the repeated measure a-priori power analysis yields a sample of 21. The correlation increases the power for the test.</p>
<p><img src="screenshots/gpower_11.png" /></p>
<p>To reproduce this analysis in Gpower with a dependent <em>t</em>-test we need to change dz following the formula above, <span class="math inline">\(d_{z}=\frac{0.5}{\sqrt{2(1-0.7)}}\)</span>, which yields dz = 0.6454972. If we enter this value in Gpower for an a-priori power analysis, we get the exact same results (as we should, since an repeated measures ANOVA with 2 groups equals a dependent <em>t</em>-test). This example illustrates that the correlation between dependent variables always factors into a power analysis, both for a dependent <em>t</em>-test, and for a repeated measures ANOVA. Because a dependent <em>t</em>-test uses dz the correlation might be less visible, but given the relation between d and dz, the correlation is always taken into account and can greatly improve power for within designs compared to between designs.</p>
<p><img src="screenshots/gpower_10.png" /></p>
<p>We can perform both these power analyses using simuations as well. We set groups to 2 for the simulation, n = 34 (which should give 80.777 power, according to the <span class="citation">Faul et al. (<a href="#ref-faul2007g">2007</a>)</span> program), a correlation among repeated measures of 0.5, and an alpha of 0.05. In this case, we simulate data with means -0.25 and 0.25, and set the sd to 1. This means we have a mean difference of 0.5, and a Cohenâs d of 0.5/1 = 0.5. In the first example, we set the correlation to 0.5, and the result should be 80.77% power, and an effect size estimate of 0.5 for the simple effect. We also calculate partial eta-squared for the ANOVA, which equals <span class="math inline">\(\frac{f^2}{f^2+1}\)</span>, or 0.05882353.</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1">K &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb106-2" title="2">n &lt;-<span class="st"> </span><span class="dv">34</span></a>
<a class="sourceLine" id="cb106-3" title="3">sd &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb106-4" title="4">r &lt;-<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb106-5" title="5">alpha =<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb106-6" title="6">f &lt;-<span class="st"> </span><span class="fl">0.25</span></a>
<a class="sourceLine" id="cb106-7" title="7">f2 &lt;-<span class="st"> </span>f<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb106-8" title="8">ES &lt;-<span class="st"> </span>f2<span class="op">/</span>(f2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb106-9" title="9">ES</a></code></pre></div>
<pre><code>## [1] 0.05882353</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1">mu &lt;-<span class="st"> </span><span class="kw">mu_from_ES</span>(<span class="dt">K =</span> K, <span class="dt">ES =</span> ES)</a>
<a class="sourceLine" id="cb108-2" title="2">design =<span class="st"> </span><span class="kw">paste</span>(K,<span class="st">&quot;w&quot;</span>,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb108-3" title="3">labelnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speed&quot;</span>, <span class="st">&quot;fast&quot;</span>, <span class="st">&quot;slow&quot;</span>)</a>
<a class="sourceLine" id="cb108-4" title="4"></a>
<a class="sourceLine" id="cb108-5" title="5">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> design,</a>
<a class="sourceLine" id="cb108-6" title="6">                   <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb108-7" title="7">                   <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb108-8" title="8">                   <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb108-9" title="9">                   <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb108-10" title="10">                   <span class="dt">labelnames =</span> labelnames)</a>
<a class="sourceLine" id="cb108-11" title="11"></a>
<a class="sourceLine" id="cb108-12" title="12">alpha_level &lt;-<span class="st"> </span><span class="fl">0.05</span></a></code></pre></div>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb109-1" title="1">simulation_result &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, </a>
<a class="sourceLine" id="cb109-2" title="2">                                 <span class="dt">alpha_level =</span> alpha_level, </a>
<a class="sourceLine" id="cb109-3" title="3">                                 <span class="dt">nsims =</span> nsims,</a>
<a class="sourceLine" id="cb109-4" title="4">                                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-98">Table 3.1: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_speed
</td>
<td style="text-align:right;">
80.74
</td>
<td style="text-align:right;">
0.2149221
</td>
</tr>
</tbody>
</table>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-100">Table 3.2: </span>Exact ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
partial_eta_squared
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
speed
</td>
<td style="text-align:right;">
80.77775
</td>
<td style="text-align:right;">
0.2048193
</td>
<td style="text-align:right;">
0.5075192
</td>
<td style="text-align:right;">
8.5
</td>
</tr>
</tbody>
</table>
<p>The results of the simulation are indeed very close to 80.777%. Note that the simulation calculates Cohenâs dz effect sizes for paired comparisons - which here given the correlation of 0.5 is also 0.5 for a medium effect size.</p>
<p>We should see a larger dz if we increase the correlation, keeping the sample size the same, following the example in Gpower above. We repeat the simulation, and the only difference is a correlation between dependent variables of 0.7. This should yield an effect size dz = 0.6454972.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1">K &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb110-2" title="2">n &lt;-<span class="st"> </span><span class="dv">21</span></a>
<a class="sourceLine" id="cb110-3" title="3">sd &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb110-4" title="4">r &lt;-<span class="st"> </span><span class="fl">0.7</span></a>
<a class="sourceLine" id="cb110-5" title="5">alpha =<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb110-6" title="6">f &lt;-<span class="st"> </span><span class="fl">0.25</span></a>
<a class="sourceLine" id="cb110-7" title="7">f2 &lt;-<span class="st"> </span>f<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb110-8" title="8">ES &lt;-<span class="st"> </span>f2<span class="op">/</span>(f2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb110-9" title="9">ES</a></code></pre></div>
<pre><code>## [1] 0.05882353</code></pre>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1">mu &lt;-<span class="st"> </span><span class="kw">mu_from_ES</span>(<span class="dt">K =</span> K, <span class="dt">ES =</span> ES)</a>
<a class="sourceLine" id="cb112-2" title="2">design =<span class="st"> </span><span class="kw">paste</span>(K,<span class="st">&quot;w&quot;</span>,<span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb112-3" title="3">labelnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speed&quot;</span>, <span class="st">&quot;fast&quot;</span>, <span class="st">&quot;slow&quot;</span>)</a>
<a class="sourceLine" id="cb112-4" title="4">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> design,</a>
<a class="sourceLine" id="cb112-5" title="5">                   <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb112-6" title="6">                   <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb112-7" title="7">                   <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb112-8" title="8">                   <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb112-9" title="9">                   <span class="dt">labelnames =</span> labelnames)</a>
<a class="sourceLine" id="cb112-10" title="10"></a>
<a class="sourceLine" id="cb112-11" title="11">alpha_level &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb112-12" title="12"></a>
<a class="sourceLine" id="cb112-13" title="13">design_result<span class="op">$</span>sigmatrix</a></code></pre></div>
<pre><code>##      fast slow
## fast  1.0  0.7
## slow  0.7  1.0</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1">simulation_result &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, </a>
<a class="sourceLine" id="cb114-2" title="2">                                 <span class="dt">alpha_level =</span> alpha_level, </a>
<a class="sourceLine" id="cb114-3" title="3">                                 <span class="dt">nsims =</span> nsims,</a>
<a class="sourceLine" id="cb114-4" title="4">                                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-103">Table 3.3: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_speed
</td>
<td style="text-align:right;">
80.48
</td>
<td style="text-align:right;">
0.3153414
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb115-1" title="1">exact_result &lt;-<span class="st"> </span><span class="kw">ANOVA_exact</span>(design_result,</a>
<a class="sourceLine" id="cb115-2" title="2">                            <span class="dt">alpha_level =</span> alpha_level,</a>
<a class="sourceLine" id="cb115-3" title="3">                            <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-105">Table 3.4: </span>Exact ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
partial_eta_squared
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
speed
</td>
<td style="text-align:right;">
80.33235
</td>
<td style="text-align:right;">
0.3043478
</td>
<td style="text-align:right;">
0.6614378
</td>
<td style="text-align:right;">
8.75
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1"><span class="co">#relation dz and f for within designs </span></a>
<a class="sourceLine" id="cb116-2" title="2">f &lt;-<span class="st"> </span><span class="fl">0.5</span><span class="op">*</span><span class="fl">0.6454972</span></a>
<a class="sourceLine" id="cb116-3" title="3"><span class="co">#  </span></a></code></pre></div>
<p>Entering this f in Gpower, with a correlation of 0.5, yields the same as entering <code>f = 0.25</code> and <code>correlation = 0.7</code>.</p>
</div>
</div>
<div id="part-2-1" class="section level2">
<h2><span class="header-section-number">3.2</span> Part 2</h2>
<p>Here, we will examine a repeated measures experiment with 3 within-subject conditions, to illustrate how a repeated measures ANOVA extends a dependent <em>t</em>-test with 3 groups.</p>
<p>In the example for a two-group within design we provided a specific formula for the sample size benefit for two groups. The sample size needed in within-designs (NW) with more than 2 conditions, relative to the sample needed in between-designs (NB), assuming normal distributions and compound symmetry, and ignoring the difference in degrees of freedom between the two types of tests, is (from <span class="citation">Maxwell et al. (<a href="#ref-maxwell_designing_2004">2004</a>)</span>, p.Â 562, formula 47):</p>
<p><span class="math inline">\(N_{W}=\frac{N_{B}(1-\rho)}{a}\)</span></p>
<p>Where a is the number of within-subject levels.</p>
<div id="the-relation-between-cohens-f-and-cohens-d" class="section level3">
<h3><span class="header-section-number">3.2.1</span> The relation between Cohenâs f and Cohenâs d</h3>
<p>Whereas in the case of a repeated measures ANOVA with 2 groups we could explain the principles of a power analysis by comparing our test against a <em>t</em>-test and Cohenâs d, this becomes more difficult when we have more than 2 groups. It is more useful to explain how to directly calculate Cohenâs <em>f</em>, the effect size used in power analyses for ANOVA. Cohenâs <em>f</em> is calculated following <span class="citation">Cohen (<a href="#ref-cohen1988spa">1988</a>)</span>, formula 8.2.1 and 8.2.2:</p>
<p><span class="math inline">\(f = \sqrt{\frac{\frac{\sum(\mu-\overline{\mu})^2)}N}\sigma}\)</span></p>
<p>Imagine we have a within-subject experiment with 3 conditions. We ask people what they mood is when their alarm clock wakes them up, when they wake up naturally on a week day, and when they wake up naturally on a weekend day. Based on pilot data, we expect the means (on a 7 point validated mood scale) are 3.8, 4.2, and 4.3. The standard deviation is 0.9, and the correlation between the dependent measurements is 0.7. We can calculate Cohenâs <em>f</em> for the ANOVA, and Cohenâs dz for the contrasts:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">mu &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">3.8</span>, <span class="fl">4.2</span>, <span class="fl">4.3</span>)</a>
<a class="sourceLine" id="cb117-2" title="2">sd &lt;-<span class="st"> </span><span class="fl">0.9</span></a>
<a class="sourceLine" id="cb117-3" title="3">f &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">sum</span>((mu <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mu)) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(mu)) <span class="op">/</span><span class="st"> </span>sd </a>
<a class="sourceLine" id="cb117-4" title="4"><span class="co">#Cohen, 1988, formula 8.2.1 and 8.2.2</span></a>
<a class="sourceLine" id="cb117-5" title="5">  f</a></code></pre></div>
<pre><code>## [1] 0.2400274</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1">  r &lt;-<span class="st"> </span><span class="fl">0.7</span></a>
<a class="sourceLine" id="cb119-2" title="2">  (<span class="fl">4.2</span> <span class="op">-</span><span class="st"> </span><span class="fl">3.8</span>) <span class="op">/</span><span class="st"> </span><span class="fl">0.9</span> <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>r))</a></code></pre></div>
<pre><code>## [1] 0.5737753</code></pre>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1">  (<span class="fl">4.3</span> <span class="op">-</span><span class="st"> </span><span class="fl">3.8</span>) <span class="op">/</span><span class="st"> </span><span class="fl">0.9</span> <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>r))</a></code></pre></div>
<pre><code>## [1] 0.7172191</code></pre>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb123-1" title="1">  (<span class="fl">4.3</span> <span class="op">-</span><span class="st"> </span><span class="fl">4.2</span>) <span class="op">/</span><span class="st"> </span><span class="fl">0.9</span> <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>r))</a></code></pre></div>
<pre><code>## [1] 0.1434438</code></pre>
<p>The relation between Cohenâs d or dz and Cohenâs <em>f</em> becomes more difficult when there are multiple groups, because the relationship depends on the pattern of the means. <span class="citation">Cohen (<a href="#ref-cohen1988spa">1988</a>)</span> presents calculations for three patterns, minimal variability (for example, for 5 means: -0.25, 0, 0, 0, 0.25), medium variability (for example, for 5 means: -0.25, -0.25, 0.25, 0.25, 0.25 or -0.25, -0.25, -0.25, 0.25, 0.25). For these three patterns, formulaâs are available that compute Cohenâs <em>f</em> from Cohenâs d, where d is the effect size calculated for the difference between the largest and smallest mean (if the largest mean is 0.25 and the smallest mean is -0.25, 0.25 - -0.25 = 0.5, so d is 0.5 divided by the standard deviation of 0.9). In our example, d would be (4.3-3.8)/0.9 = 0.5555556. If we divide this value by <code>sqrt(2*(1-r))</code> we have dz = 0.5555556/0.7745967 = 0.7172191.</p>
<p>I have created a custom function that will calculate f from d, based on a specification of one of the three patterns of means. Our pattern is most similar (but not identical) to a maximum variability pattern (two means are high, one is lower). So we could attempt to calculate f from d (0.5555556), by calculating d from the largest and smallest mean:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb125-1" title="1"><span class="co">#This function allows you to calculate f, d and eta squared </span></a>
<a class="sourceLine" id="cb125-2" title="2"><span class="co">#following Cohen, 1988, p 277</span></a>
<a class="sourceLine" id="cb125-3" title="3"><span class="co"># From Cohen, 1988, p 277</span></a>
<a class="sourceLine" id="cb125-4" title="4"><span class="co"># The patterns are:</span></a>
<a class="sourceLine" id="cb125-5" title="5"><span class="co"># I. Minimum variability: one mean at each end of d, </span></a>
<a class="sourceLine" id="cb125-6" title="6"><span class="co">#the remaining k- 2 means all at the midpoint.</span></a>
<a class="sourceLine" id="cb125-7" title="7"><span class="co"># 2. Intermediate variability: the k means equally spaced over d.</span></a>
<a class="sourceLine" id="cb125-8" title="8"><span class="co"># 3. Maximum variability: the means all at the end points of d.</span></a>
<a class="sourceLine" id="cb125-9" title="9"></a>
<a class="sourceLine" id="cb125-10" title="10"><span class="co"># For each of these patterns, </span></a>
<a class="sourceLine" id="cb125-11" title="11"><span class="co"># there is a fixed relationship between f and d for any given number of means, k.</span></a>
<a class="sourceLine" id="cb125-12" title="12"></a>
<a class="sourceLine" id="cb125-13" title="13"><span class="co"># Pattern 1. For any given range of means, d, the minimum standard</span></a>
<a class="sourceLine" id="cb125-14" title="14"><span class="co"># deviation, f1, results when the remaining k - 2 means are concentrated at</span></a>
<a class="sourceLine" id="cb125-15" title="15"><span class="co"># the mean of the means (0 when expressed in standard units), i.e., half-way</span></a>
<a class="sourceLine" id="cb125-16" title="16"><span class="co"># between the largest and smallest.</span></a>
<a class="sourceLine" id="cb125-17" title="17"><span class="co"># </span></a>
<a class="sourceLine" id="cb125-18" title="18"><span class="co"># Pattern 2. A pattern of medium variability results when the k means</span></a>
<a class="sourceLine" id="cb125-19" title="19"><span class="co"># are equally spaced over the range, and therefore at intervals of d/(k- 1).</span></a>
<a class="sourceLine" id="cb125-20" title="20"><span class="co"># </span></a>
<a class="sourceLine" id="cb125-21" title="21"><span class="co"># Pattern 3. It is demonstrable and intuitively evident that for any given</span></a>
<a class="sourceLine" id="cb125-22" title="22"><span class="co"># range the dispersion which yield~ the maximum standard deviation has the</span></a>
<a class="sourceLine" id="cb125-23" title="23"><span class="co"># k means falling at both extremes of the range. When k is even, !k fall at</span></a>
<a class="sourceLine" id="cb125-24" title="24"><span class="co"># - !d and the other !k fall at + !d; when k is odd, (k + I )/2 of the means</span></a>
<a class="sourceLine" id="cb125-25" title="25"><span class="co"># fall at either end and the (k- 1)/2 remaining means at the other. With this</span></a>
<a class="sourceLine" id="cb125-26" title="26"><span class="co"># pattern, for all even numbers of means, use formula (8.2.12).</span></a>
<a class="sourceLine" id="cb125-27" title="27"><span class="co"># When k is odd, and there is thus one more mean at one extreme than at</span></a>
<a class="sourceLine" id="cb125-28" title="28"><span class="co"># the other, use formula (8.2.13).</span></a>
<a class="sourceLine" id="cb125-29" title="29"></a>
<a class="sourceLine" id="cb125-30" title="30">calc_f_d_eta &lt;-<span class="st"> </span><span class="cf">function</span>(mu, sd, variability){</a>
<a class="sourceLine" id="cb125-31" title="31">  <span class="cf">if</span> (variability <span class="op">==</span><span class="st"> &quot;minimum&quot;</span>) {</a>
<a class="sourceLine" id="cb125-32" title="32">    k =<span class="st"> </span><span class="kw">length</span>(mu)</a>
<a class="sourceLine" id="cb125-33" title="33">    d &lt;-<span class="st"> </span>(<span class="kw">max</span>(mu) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(mu)) <span class="op">/</span><span class="st"> </span>sd</a>
<a class="sourceLine" id="cb125-34" title="34">    f &lt;-<span class="st"> </span>d <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>k))</a>
<a class="sourceLine" id="cb125-35" title="35">    f2 &lt;-<span class="st"> </span>f <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb125-36" title="36">    ES &lt;-<span class="st"> </span>f2 <span class="op">/</span><span class="st"> </span>(f2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb125-37" title="37">  }</a>
<a class="sourceLine" id="cb125-38" title="38">  <span class="cf">if</span> (variability <span class="op">==</span><span class="st"> &quot;medium&quot;</span>) {</a>
<a class="sourceLine" id="cb125-39" title="39">    k =<span class="st"> </span><span class="kw">length</span>(mu)</a>
<a class="sourceLine" id="cb125-40" title="40">    d &lt;-<span class="st"> </span>(<span class="kw">max</span>(mu) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(mu)) <span class="op">/</span><span class="st"> </span>sd</a>
<a class="sourceLine" id="cb125-41" title="41">    f &lt;-<span class="st"> </span>(d <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span><span class="kw">sqrt</span>((k <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>(<span class="dv">3</span> <span class="op">*</span><span class="st"> </span>(k <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)))</a>
<a class="sourceLine" id="cb125-42" title="42">    f2 &lt;-<span class="st"> </span>f <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb125-43" title="43">    ES &lt;-<span class="st"> </span>f2 <span class="op">/</span><span class="st"> </span>(f2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb125-44" title="44">  }</a>
<a class="sourceLine" id="cb125-45" title="45">  <span class="cf">if</span> (variability <span class="op">==</span><span class="st"> &quot;maximum&quot;</span>) {</a>
<a class="sourceLine" id="cb125-46" title="46">    k =<span class="st"> </span><span class="kw">length</span>(mu)</a>
<a class="sourceLine" id="cb125-47" title="47">    d &lt;-<span class="st"> </span>(<span class="kw">max</span>(mu) <span class="op">-</span><span class="st"> </span><span class="kw">min</span>(mu)) <span class="op">/</span><span class="st"> </span>sd</a>
<a class="sourceLine" id="cb125-48" title="48">    f &lt;-<span class="st"> </span><span class="kw">ifelse</span>(k <span class="op">%%</span><span class="st"> </span><span class="dv">2</span> <span class="op">==</span><span class="st"> </span><span class="dv">0</span>, <span class="fl">.5</span> <span class="op">*</span><span class="st"> </span>d, d <span class="op">*</span><span class="st"> </span>(<span class="kw">sqrt</span>(k <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span> <span class="op">*</span><span class="st"> </span>k)))</a>
<a class="sourceLine" id="cb125-49" title="49">    f2 &lt;-<span class="st"> </span>f <span class="op">^</span><span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb125-50" title="50">    ES &lt;-<span class="st"> </span>f2 <span class="op">/</span><span class="st"> </span>(f2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb125-51" title="51">  }</a>
<a class="sourceLine" id="cb125-52" title="52">  <span class="kw">invisible</span>(<span class="kw">list</span>(<span class="dt">mu =</span> mu,</a>
<a class="sourceLine" id="cb125-53" title="53">                 <span class="dt">sd =</span> sd,</a>
<a class="sourceLine" id="cb125-54" title="54">                 <span class="dt">d =</span> d,</a>
<a class="sourceLine" id="cb125-55" title="55">                 <span class="dt">f =</span> f,</a>
<a class="sourceLine" id="cb125-56" title="56">                 <span class="dt">f2 =</span> f2,</a>
<a class="sourceLine" id="cb125-57" title="57">                 <span class="dt">ES =</span> ES))</a>
<a class="sourceLine" id="cb125-58" title="58">}</a>
<a class="sourceLine" id="cb125-59" title="59">res &lt;-<span class="st"> </span><span class="kw">calc_f_d_eta</span>(<span class="dt">mu =</span> mu, <span class="dt">sd =</span> sd, <span class="dt">variability =</span> <span class="st">&quot;maximum&quot;</span>)</a>
<a class="sourceLine" id="cb125-60" title="60">res<span class="op">$</span>f</a></code></pre></div>
<pre><code>## [1] 0.2618914</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb127-1" title="1">res<span class="op">$</span>d</a></code></pre></div>
<pre><code>## [1] 0.5555556</code></pre>
<p>We see the Cohenâs <em>f</em> value is 0.2618914 and d = 0.5555556. The Cohenâs <em>f</em> is not perfectly accurate - it is assuming the pattern of means is 3.8, 4.3, 4.3, and not 3.8, 4.2, 4.3. If the means and sd is known, it is best to calculate Cohenâs <em>f</em> directly from these values.</p>
</div>
<div id="three-within-conditions-medium-effect-size" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Three within conditions, medium effect size</h3>
<p>We can perform power analyses for within designs using simuations. We set groups to 3 for the simulation, n = 20, and the correlation between dependent variables to 0.8. If the true effect size is f = 0.25, and the alpha level is 0.05, the power is 96.6%.</p>
<p>In this case, we simulate data with means -0.3061862, 0.0000000, and 0.3061862, and set the sd to 1.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb129-1" title="1">K &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb129-2" title="2">n &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb129-3" title="3">sd &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb129-4" title="4">r &lt;-<span class="st"> </span><span class="fl">0.8</span></a>
<a class="sourceLine" id="cb129-5" title="5">alpha =<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb129-6" title="6">f &lt;-<span class="st"> </span><span class="fl">0.25</span></a>
<a class="sourceLine" id="cb129-7" title="7">f2 &lt;-<span class="st"> </span>f<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb129-8" title="8">ES &lt;-<span class="st"> </span>f2 <span class="op">/</span><span class="st"> </span>(f2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb129-9" title="9">ES</a></code></pre></div>
<pre><code>## [1] 0.05882353</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb131-1" title="1">mu &lt;-<span class="st"> </span><span class="kw">mu_from_ES</span>(<span class="dt">K =</span> K, <span class="dt">ES =</span> ES)</a>
<a class="sourceLine" id="cb131-2" title="2"></a>
<a class="sourceLine" id="cb131-3" title="3"><span class="co">#Cohen, 1988, formula 8.2.1 and 8.2.2</span></a>
<a class="sourceLine" id="cb131-4" title="4"><span class="kw">sqrt</span>(<span class="kw">sum</span>((mu <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mu)) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(mu)) <span class="op">/</span><span class="st"> </span>sd </a></code></pre></div>
<pre><code>## [1] 0.25</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb133-1" title="1">design =<span class="st"> </span><span class="kw">paste</span>(K, <span class="st">&quot;w&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb133-2" title="2">labelnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speed&quot;</span>, <span class="st">&quot;fast&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;slow&quot;</span>)</a>
<a class="sourceLine" id="cb133-3" title="3">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> design,</a>
<a class="sourceLine" id="cb133-4" title="4">                   <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb133-5" title="5">                   <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb133-6" title="6">                   <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb133-7" title="7">                   <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb133-8" title="8">                   <span class="dt">labelnames =</span> labelnames)</a>
<a class="sourceLine" id="cb133-9" title="9"></a>
<a class="sourceLine" id="cb133-10" title="10">alpha_level &lt;-<span class="st"> </span><span class="fl">0.05</span></a></code></pre></div>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1">simulation_result &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, </a>
<a class="sourceLine" id="cb134-2" title="2">                                 <span class="dt">alpha_level =</span> alpha_level, </a>
<a class="sourceLine" id="cb134-3" title="3">                                 <span class="dt">nsims =</span> nsims,</a>
<a class="sourceLine" id="cb134-4" title="4">                                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-111">Table 3.5: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_speed
</td>
<td style="text-align:right;">
97.04
</td>
<td style="text-align:right;">
0.345486
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb135-1" title="1">exact_result &lt;-<span class="st"> </span><span class="kw">ANOVA_exact</span>(design_result,</a>
<a class="sourceLine" id="cb135-2" title="2">                            <span class="dt">alpha_level =</span> alpha_level,</a>
<a class="sourceLine" id="cb135-3" title="3">                            <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-113">Table 3.6: </span>Exact ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
partial_eta_squared
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
speed
</td>
<td style="text-align:right;">
96.91634
</td>
<td style="text-align:right;">
0.3303965
</td>
<td style="text-align:right;">
0.7024394
</td>
<td style="text-align:right;">
18.75
</td>
</tr>
</tbody>
</table>
<p>The results of the simulation are indeed very close to 96.9%. We can see this is in line with the power estimate from Gpower:</p>
<p><img src="screenshots/gpower_12.png" /></p>
<p>We can also validate this by creating the code to do a power analysis in R from scratch:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1">K &lt;-<span class="st"> </span><span class="dv">3</span> <span class="co">#three groups</span></a>
<a class="sourceLine" id="cb136-2" title="2">n &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb136-3" title="3">sd &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb136-4" title="4">r &lt;-<span class="st"> </span><span class="fl">0.8</span></a>
<a class="sourceLine" id="cb136-5" title="5">alpha =<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb136-6" title="6">f &lt;-<span class="st"> </span><span class="fl">0.25</span></a>
<a class="sourceLine" id="cb136-7" title="7">f2 &lt;-<span class="st"> </span>f<span class="op">^</span><span class="dv">2</span></a>
<a class="sourceLine" id="cb136-8" title="8">ES &lt;-<span class="st"> </span>f2 <span class="op">/</span><span class="st"> </span>(f2 <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb136-9" title="9">ES</a></code></pre></div>
<pre><code>## [1] 0.05882353</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1">mu &lt;-<span class="st"> </span><span class="kw">mu_from_ES</span>(<span class="dt">K =</span> K, <span class="dt">ES =</span> ES)</a>
<a class="sourceLine" id="cb138-2" title="2">design =<span class="st"> </span><span class="kw">paste</span>(K, <span class="st">&quot;w&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb138-3" title="3">labelnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speed&quot;</span>, <span class="st">&quot;fast&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;slow&quot;</span>)</a>
<a class="sourceLine" id="cb138-4" title="4">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> design,</a>
<a class="sourceLine" id="cb138-5" title="5">                   <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb138-6" title="6">                   <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb138-7" title="7">                   <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb138-8" title="8">                   <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb138-9" title="9">                   <span class="dt">labelnames =</span> labelnames)</a>
<a class="sourceLine" id="cb138-10" title="10"></a>
<a class="sourceLine" id="cb138-11" title="11"><span class="kw">power_oneway_within</span>(design_result)<span class="op">$</span>power</a></code></pre></div>
<pre><code>## [1] 96.91634</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1"><span class="kw">power_oneway_within</span>(design_result)<span class="op">$</span>eta_p_<span class="dv">2</span></a></code></pre></div>
<pre><code>## [1] 0.05882353</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1"><span class="kw">power_oneway_within</span>(design_result)<span class="op">$</span>eta_p_<span class="dv">2</span>_SPSS</a></code></pre></div>
<pre><code>## [1] 0.3303965</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1"><span class="kw">power_oneway_within</span>(design_result)<span class="op">$</span>Cohen_f</a></code></pre></div>
<pre><code>## [1] 0.25</code></pre>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb146-1" title="1"><span class="kw">power_oneway_within</span>(design_result)<span class="op">$</span>Cohen_f_SPSS</a></code></pre></div>
<pre><code>## [1] 0.7024394</code></pre>
<p>We can even check the calculation of Cohenâs <em>f</em> SPSS style in GPower. We take the GPower settings as illustrated above. We click the âOptionsâ button, and check the radiobutton next to âAs in SPSSâ. Click ok, and you will notice that the âCorr among rep measuresâ field has disappeared. The correlation does not need to be entered seperately, but is incorporated in Cohenâs <em>f</em>. The value of Cohenâs <em>f</em>, which was 0.25, has changed into 0.7024394. This is the SPSS equivalent. The value is much larger. This value, and itâs corresponding partial eta-squared, incorporate the correlation between observations.</p>
<p><img src="screenshots/gpower_14.png" /></p>
</div>
</div>
<div id="part-3-1" class="section level2">
<h2><span class="header-section-number">3.3</span> Part 3</h2>
<p>We first repeat the simulation by Brysbaert:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb148-1" title="1"><span class="co"># give sample size</span></a>
<a class="sourceLine" id="cb148-2" title="2">N =<span class="st"> </span><span class="dv">75</span></a>
<a class="sourceLine" id="cb148-3" title="3"><span class="co"># give effect size d</span></a>
<a class="sourceLine" id="cb148-4" title="4">d1 =<span class="st"> </span><span class="fl">.4</span> <span class="co">#difference between the extremes</span></a>
<a class="sourceLine" id="cb148-5" title="5">d2 =<span class="st"> </span><span class="fl">.4</span> <span class="co">#third condition goes with the highest extreme</span></a>
<a class="sourceLine" id="cb148-6" title="6"><span class="co"># give the correlation between the conditions</span></a>
<a class="sourceLine" id="cb148-7" title="7">r =<span class="st"> </span><span class="fl">.5</span></a>
<a class="sourceLine" id="cb148-8" title="8"><span class="co"># give number of simulations</span></a>
<a class="sourceLine" id="cb148-9" title="9">nSim =<span class="st"> </span>nsims</a>
<a class="sourceLine" id="cb148-10" title="10"><span class="co"># give alpha levels</span></a>
<a class="sourceLine" id="cb148-11" title="11">alpha1 =<span class="st"> </span><span class="fl">.05</span> <span class="co">#alpha level for the omnibus ANOVA</span></a>
<a class="sourceLine" id="cb148-12" title="12">alpha2 =<span class="st"> </span><span class="fl">.05</span> <span class="co">#also adjusted from original by DL</span></a></code></pre></div>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb149-1" title="1"><span class="co"># create vectors to store p-values</span></a>
<a class="sourceLine" id="cb149-2" title="2">p1 &lt;-<span class="st"> </span><span class="kw">numeric</span>(nSim) <span class="co">#p-value omnibus ANOVA</span></a>
<a class="sourceLine" id="cb149-3" title="3">p2 &lt;-<span class="st"> </span><span class="kw">numeric</span>(nSim) <span class="co">#p-value first post hoc test</span></a>
<a class="sourceLine" id="cb149-4" title="4">p3 &lt;-<span class="st"> </span><span class="kw">numeric</span>(nSim) <span class="co">#p-value second post hoc test</span></a>
<a class="sourceLine" id="cb149-5" title="5">p4 &lt;-<span class="st"> </span><span class="kw">numeric</span>(nSim) <span class="co">#p-value third post hoc test</span></a>
<a class="sourceLine" id="cb149-6" title="6"></a>
<a class="sourceLine" id="cb149-7" title="7"><span class="co"># define correlation matrix</span></a>
<a class="sourceLine" id="cb149-8" title="8">rho &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, r, r), <span class="kw">c</span>(r, <span class="dv">1</span>, r), <span class="kw">c</span>(r, r, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb149-9" title="9"><span class="co"># define participant codes</span></a>
<a class="sourceLine" id="cb149-10" title="10">part &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;part&quot;</span>,<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span>N))</a>
<a class="sourceLine" id="cb149-11" title="11"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nSim) {</a>
<a class="sourceLine" id="cb149-12" title="12">  <span class="co">#for each simulated experiment</span></a>
<a class="sourceLine" id="cb149-13" title="13"></a>
<a class="sourceLine" id="cb149-14" title="14">  data =<span class="st"> </span><span class="kw">mvrnorm</span>(<span class="dt">n =</span> N,</a>
<a class="sourceLine" id="cb149-15" title="15">  <span class="dt">mu =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb149-16" title="16">  <span class="dt">Sigma =</span> rho)</a>
<a class="sourceLine" id="cb149-17" title="17">  data[, <span class="dv">2</span>] =<span class="st"> </span>data[, <span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>d1</a>
<a class="sourceLine" id="cb149-18" title="18">  data[, <span class="dv">3</span>] =<span class="st"> </span>data[, <span class="dv">3</span>] <span class="op">+</span><span class="st"> </span>d2</a>
<a class="sourceLine" id="cb149-19" title="19">  datalong =<span class="st"> </span><span class="kw">c</span>(data[, <span class="dv">1</span>], data[, <span class="dv">2</span>], data[, <span class="dv">3</span>])</a>
<a class="sourceLine" id="cb149-20" title="20">  conds =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(letters[<span class="dv">24</span><span class="op">:</span><span class="dv">26</span>], <span class="dt">each =</span> N))</a>
<a class="sourceLine" id="cb149-21" title="21">  partID =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(part, <span class="dt">times =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb149-22" title="22">  output &lt;-<span class="st"> </span><span class="kw">data.frame</span>(partID, conds, datalong)</a>
<a class="sourceLine" id="cb149-23" title="23">  test &lt;-<span class="st"> </span><span class="kw">aov</span>(datalong <span class="op">~</span><span class="st"> </span>conds <span class="op">+</span><span class="st"> </span><span class="kw">Error</span>(partID <span class="op">/</span><span class="st"> </span>conds), <span class="dt">data =</span> output)</a>
<a class="sourceLine" id="cb149-24" title="24">  tests &lt;-<span class="st"> </span>(<span class="kw">summary</span>(test))</a>
<a class="sourceLine" id="cb149-25" title="25">  p1[i] &lt;-<span class="st"> </span>tests<span class="op">$</span><span class="st">&#39;Error: partID:conds&#39;</span>[[<span class="dv">1</span>]]<span class="op">$</span><span class="st">&#39;Pr(&gt;F)&#39;</span>[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb149-26" title="26">  p2[i] &lt;-<span class="st"> </span><span class="kw">t.test</span>(data[, <span class="dv">1</span>], data[, <span class="dv">2</span>], <span class="dt">paired =</span> <span class="ot">TRUE</span>)<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb149-27" title="27">  p3[i] &lt;-<span class="st"> </span><span class="kw">t.test</span>(data[, <span class="dv">1</span>], data[, <span class="dv">3</span>], <span class="dt">paired =</span> <span class="ot">TRUE</span>)<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb149-28" title="28">  p4[i] &lt;-<span class="st"> </span><span class="kw">t.test</span>(data[, <span class="dv">2</span>], data[, <span class="dv">3</span>], <span class="dt">paired =</span> <span class="ot">TRUE</span>)<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb149-29" title="29">}</a></code></pre></div>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb150-1" title="1"><span class="co">#printing all unique tests (adjusted code by DL)</span></a>
<a class="sourceLine" id="cb150-2" title="2"><span class="kw">sum</span>(p1 <span class="op">&lt;</span><span class="st"> </span>alpha1) <span class="op">/</span><span class="st"> </span>nSim</a>
<a class="sourceLine" id="cb150-3" title="3"><span class="kw">sum</span>(p2 <span class="op">&lt;</span><span class="st"> </span>alpha2) <span class="op">/</span><span class="st"> </span>nSim</a>
<a class="sourceLine" id="cb150-4" title="4"><span class="kw">sum</span>(p3 <span class="op">&lt;</span><span class="st"> </span>alpha2) <span class="op">/</span><span class="st"> </span>nSim</a>
<a class="sourceLine" id="cb150-5" title="5"><span class="kw">sum</span>(p4 <span class="op">&lt;</span><span class="st"> </span>alpha2) <span class="op">/</span><span class="st"> </span>nSim</a></code></pre></div>
<pre><code>## [1] 0.7961</code></pre>
<pre><code>## [1] 0.7624</code></pre>
<pre><code>## [1] 0.7574</code></pre>
<pre><code>## [1] 0.0452</code></pre>
<div id="reproducing-brysbaerts-examples" class="section level3">
<h3><span class="header-section-number">3.3.1</span> Reproducing Brysbaertâs Examples</h3>
<p>We can reproduce the same results as Brysbaert finds with his code:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb155-1" title="1">design &lt;-<span class="st"> &quot;3w&quot;</span></a>
<a class="sourceLine" id="cb155-2" title="2">n &lt;-<span class="st"> </span><span class="dv">75</span></a>
<a class="sourceLine" id="cb155-3" title="3">mu &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>)</a>
<a class="sourceLine" id="cb155-4" title="4">sd &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb155-5" title="5">r &lt;-<span class="st"> </span><span class="fl">0.5</span></a>
<a class="sourceLine" id="cb155-6" title="6">labelnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;speed&quot;</span>, <span class="st">&quot;fast&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;slow&quot;</span>)</a></code></pre></div>
<p>We create the within design, and run the simulation</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb156-1" title="1">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> design,</a>
<a class="sourceLine" id="cb156-2" title="2">                   <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb156-3" title="3">                   <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb156-4" title="4">                   <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb156-5" title="5">                   <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb156-6" title="6">                   <span class="dt">labelnames =</span> labelnames)</a></code></pre></div>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb157-1" title="1">simulation_result &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, </a>
<a class="sourceLine" id="cb157-2" title="2">                                 <span class="dt">alpha_level =</span> alpha_level, </a>
<a class="sourceLine" id="cb157-3" title="3">                                 <span class="dt">nsims =</span> nsims,</a>
<a class="sourceLine" id="cb157-4" title="4">                                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-122">Table 3.7: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_speed
</td>
<td style="text-align:right;">
95.25
</td>
<td style="text-align:right;">
0.1075912
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb158-1" title="1">exact_result &lt;-<span class="st"> </span><span class="kw">ANOVA_exact</span>(design_result,</a>
<a class="sourceLine" id="cb158-2" title="2">                            <span class="dt">alpha_level =</span> alpha_level,</a>
<a class="sourceLine" id="cb158-3" title="3">                            <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-124">Table 3.8: </span>Exact ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
partial_eta_squared
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
speed
</td>
<td style="text-align:right;">
95.29217
</td>
<td style="text-align:right;">
0.097561
</td>
<td style="text-align:right;">
0.328798
</td>
<td style="text-align:right;">
16
</td>
</tr>
</tbody>
</table>
<p><strong>Results</strong></p>
<p>The results of the simulation are very similar. Power for the ANOVA <em>F</em>-test is around 95.2%. For the three paired t-tests, power is around 92.7. This is in line with the a-priori power analysis when using Gpower:</p>
<p><img src="screenshots/gpower_2.png" /></p>
<p>We can perform an post-hoc power analysis in Gpower. We can calculate CohenÂ´s f based on the means and sd, using our own custom formula.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb159-1" title="1"><span class="co"># Our simulation is based onthe following means and sd:</span></a>
<a class="sourceLine" id="cb159-2" title="2"><span class="co"># mu &lt;- c(0, 0.4, 0.4)</span></a>
<a class="sourceLine" id="cb159-3" title="3"><span class="co"># sd &lt;- 1</span></a>
<a class="sourceLine" id="cb159-4" title="4"><span class="co"># Cohen, 1988, formula 8.2.1 and 8.2.2</span></a>
<a class="sourceLine" id="cb159-5" title="5">f &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="kw">sum</span>((mu <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(mu)) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span><span class="kw">length</span>(mu)) <span class="op">/</span><span class="st"> </span>sd </a>
<a class="sourceLine" id="cb159-6" title="6"></a>
<a class="sourceLine" id="cb159-7" title="7"><span class="co"># We can see why f = 0.5*d.</span></a>
<a class="sourceLine" id="cb159-8" title="8"><span class="co"># Imagine 2 group, mu = 1 and 2</span></a>
<a class="sourceLine" id="cb159-9" title="9"><span class="co"># Grand mean is 1.5, </span></a>
<a class="sourceLine" id="cb159-10" title="10"><span class="co"># we have sqrt(sum(0.5^2 + 0.5^2)/2), or sqrt(0.5/2), = 0.5.</span></a>
<a class="sourceLine" id="cb159-11" title="11"><span class="co"># For Cohen&#39;s d we use the difference, 2-1 = 1. </span></a></code></pre></div>
<p>The CohenÂ´s <em>f</em> is 0.1885618. We can enter the <em>f</em> (using the default âas in G*Power 3.0â in the option window) and enter a sample size of 75, number of groups as 1, number of measurements as 3, correlation as 0.5. This yields:</p>
<p><img src="screenshots/gpower_3.png" /></p>
</div>
<div id="reproducing-brysbaert-variation-1-changing-correlation" class="section level3">
<h3><span class="header-section-number">3.3.2</span> Reproducing Brysbaert Variation 1: Changing Correlation</h3>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" title="1"><span class="co"># give sample size</span></a>
<a class="sourceLine" id="cb160-2" title="2">N =<span class="st"> </span><span class="dv">75</span></a>
<a class="sourceLine" id="cb160-3" title="3"><span class="co"># give effect size d</span></a>
<a class="sourceLine" id="cb160-4" title="4">d1 =<span class="st"> </span><span class="fl">.4</span> <span class="co">#difference between the extremes</span></a>
<a class="sourceLine" id="cb160-5" title="5">d2 =<span class="st"> </span><span class="fl">.4</span> <span class="co">#third condition goes with the highest extreme</span></a>
<a class="sourceLine" id="cb160-6" title="6"><span class="co"># give the correlation between the conditions</span></a>
<a class="sourceLine" id="cb160-7" title="7">r =<span class="st"> </span><span class="fl">.6</span> <span class="co">#increased correlation</span></a>
<a class="sourceLine" id="cb160-8" title="8"><span class="co"># give number of simulations</span></a>
<a class="sourceLine" id="cb160-9" title="9">nSim =<span class="st"> </span>nsims</a>
<a class="sourceLine" id="cb160-10" title="10"><span class="co"># give alpha levels</span></a>
<a class="sourceLine" id="cb160-11" title="11">alpha1 =<span class="st"> </span><span class="fl">.05</span> <span class="co">#alpha level for the omnibus ANOVA</span></a>
<a class="sourceLine" id="cb160-12" title="12">alpha2 =<span class="st"> </span><span class="fl">.05</span> <span class="co">#also adjusted from original by DL</span></a></code></pre></div>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" title="1"><span class="co"># create vectors to store p-values</span></a>
<a class="sourceLine" id="cb161-2" title="2">p1 &lt;-<span class="st"> </span><span class="kw">numeric</span>(nSim) <span class="co">#p-value omnibus ANOVA</span></a>
<a class="sourceLine" id="cb161-3" title="3">p2 &lt;-<span class="st"> </span><span class="kw">numeric</span>(nSim) <span class="co">#p-value first post hoc test</span></a>
<a class="sourceLine" id="cb161-4" title="4">p3 &lt;-<span class="st"> </span><span class="kw">numeric</span>(nSim) <span class="co">#p-value second post hoc test</span></a>
<a class="sourceLine" id="cb161-5" title="5">p4 &lt;-<span class="st"> </span><span class="kw">numeric</span>(nSim) <span class="co">#p-value third post hoc test</span></a>
<a class="sourceLine" id="cb161-6" title="6"></a>
<a class="sourceLine" id="cb161-7" title="7"><span class="co"># define correlation matrix</span></a>
<a class="sourceLine" id="cb161-8" title="8">rho &lt;-<span class="st"> </span><span class="kw">cbind</span>(<span class="kw">c</span>(<span class="dv">1</span>, r, r), <span class="kw">c</span>(r, <span class="dv">1</span>, r), <span class="kw">c</span>(r, r, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb161-9" title="9"><span class="co"># define participant codes</span></a>
<a class="sourceLine" id="cb161-10" title="10">part &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;part&quot;</span>,<span class="kw">seq</span>(<span class="dv">1</span><span class="op">:</span>N))</a>
<a class="sourceLine" id="cb161-11" title="11"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nSim) {</a>
<a class="sourceLine" id="cb161-12" title="12">  </a>
<a class="sourceLine" id="cb161-13" title="13">  <span class="co">#for each simulated experiment</span></a>
<a class="sourceLine" id="cb161-14" title="14"></a>
<a class="sourceLine" id="cb161-15" title="15">  data =<span class="st"> </span><span class="kw">mvrnorm</span>(<span class="dt">n =</span> N,</a>
<a class="sourceLine" id="cb161-16" title="16">  <span class="dt">mu =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>),</a>
<a class="sourceLine" id="cb161-17" title="17">  <span class="dt">Sigma =</span> rho)</a>
<a class="sourceLine" id="cb161-18" title="18">  data[, <span class="dv">2</span>] =<span class="st"> </span>data[, <span class="dv">2</span>] <span class="op">+</span><span class="st"> </span>d1</a>
<a class="sourceLine" id="cb161-19" title="19">  data[, <span class="dv">3</span>] =<span class="st"> </span>data[, <span class="dv">3</span>] <span class="op">+</span><span class="st"> </span>d2</a>
<a class="sourceLine" id="cb161-20" title="20">  datalong =<span class="st"> </span><span class="kw">c</span>(data[, <span class="dv">1</span>], data[, <span class="dv">2</span>], data[, <span class="dv">3</span>])</a>
<a class="sourceLine" id="cb161-21" title="21">  conds =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(letters[<span class="dv">24</span><span class="op">:</span><span class="dv">26</span>], <span class="dt">each =</span> N))</a>
<a class="sourceLine" id="cb161-22" title="22">  partID =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">rep</span>(part, <span class="dt">times =</span> <span class="dv">3</span>))</a>
<a class="sourceLine" id="cb161-23" title="23">  output &lt;-<span class="st"> </span><span class="kw">data.frame</span>(partID, conds, datalong)</a>
<a class="sourceLine" id="cb161-24" title="24">  test &lt;-<span class="st"> </span><span class="kw">aov</span>(datalong <span class="op">~</span><span class="st"> </span>conds <span class="op">+</span><span class="st"> </span><span class="kw">Error</span>(partID <span class="op">/</span><span class="st"> </span>conds), <span class="dt">data =</span> output)</a>
<a class="sourceLine" id="cb161-25" title="25">  tests &lt;-<span class="st"> </span>(<span class="kw">summary</span>(test))</a>
<a class="sourceLine" id="cb161-26" title="26">  p1[i] &lt;-<span class="st"> </span>tests<span class="op">$</span><span class="st">&#39;Error: partID:conds&#39;</span>[[<span class="dv">1</span>]]<span class="op">$</span><span class="st">&#39;Pr(&gt;F)&#39;</span>[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb161-27" title="27">  p2[i] &lt;-<span class="st"> </span><span class="kw">t.test</span>(data[, <span class="dv">1</span>], data[, <span class="dv">2</span>], <span class="dt">paired =</span> <span class="ot">TRUE</span>)<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb161-28" title="28">  p3[i] &lt;-<span class="st"> </span><span class="kw">t.test</span>(data[, <span class="dv">1</span>], data[, <span class="dv">3</span>], <span class="dt">paired =</span> <span class="ot">TRUE</span>)<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb161-29" title="29">  p4[i] &lt;-<span class="st"> </span><span class="kw">t.test</span>(data[, <span class="dv">2</span>], data[, <span class="dv">3</span>], <span class="dt">paired =</span> <span class="ot">TRUE</span>)<span class="op">$</span>p.value</a>
<a class="sourceLine" id="cb161-30" title="30">}</a></code></pre></div>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" title="1"><span class="kw">sum</span>(p1 <span class="op">&lt;</span><span class="st"> </span>alpha1) <span class="op">/</span><span class="st"> </span>nSim</a>
<a class="sourceLine" id="cb162-2" title="2"><span class="kw">sum</span>(p2 <span class="op">&lt;</span><span class="st"> </span>alpha2) <span class="op">/</span><span class="st"> </span>nSim</a>
<a class="sourceLine" id="cb162-3" title="3"><span class="kw">sum</span>(p3 <span class="op">&lt;</span><span class="st"> </span>alpha2) <span class="op">/</span><span class="st"> </span>nSim</a>
<a class="sourceLine" id="cb162-4" title="4"><span class="kw">sum</span>(p4 <span class="op">&lt;</span><span class="st"> </span>alpha2) <span class="op">/</span><span class="st"> </span>nSim</a></code></pre></div>
<pre><code>## [1] 0.9472</code></pre>
<pre><code>## [1] 0.9245</code></pre>
<pre><code>## [1] 0.0503</code></pre>
<pre><code>## [1] 0.923</code></pre>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" title="1">design &lt;-<span class="st"> &quot;3w&quot;</span></a>
<a class="sourceLine" id="cb167-2" title="2">n &lt;-<span class="st"> </span><span class="dv">75</span></a>
<a class="sourceLine" id="cb167-3" title="3">mu &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.4</span>, <span class="fl">0.4</span>)</a>
<a class="sourceLine" id="cb167-4" title="4">sd &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb167-5" title="5">r &lt;-<span class="st"> </span><span class="fl">0.6</span></a>
<a class="sourceLine" id="cb167-6" title="6">labelnames &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;SPEED&quot;</span>, </a>
<a class="sourceLine" id="cb167-7" title="7">                <span class="st">&quot;fast&quot;</span>, <span class="st">&quot;medium&quot;</span>, <span class="st">&quot;slow&quot;</span>)</a></code></pre></div>
<p>We create the 3-level repeated measures design, and run the simulation.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" title="1">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> design,</a>
<a class="sourceLine" id="cb168-2" title="2">                   <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb168-3" title="3">                   <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb168-4" title="4">                   <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb168-5" title="5">                   <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb168-6" title="6">                   <span class="dt">labelnames =</span> labelnames)</a></code></pre></div>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb169-1" title="1">simulation_result &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, </a>
<a class="sourceLine" id="cb169-2" title="2">                                 <span class="dt">alpha_level =</span> alpha_level, </a>
<a class="sourceLine" id="cb169-3" title="3">                                 <span class="dt">nsims =</span> nsims,</a>
<a class="sourceLine" id="cb169-4" title="4">                                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-133">Table 3.9: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_SPEED
</td>
<td style="text-align:right;">
98.37
</td>
<td style="text-align:right;">
0.1287432
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" title="1">exact_result &lt;-<span class="st"> </span><span class="kw">ANOVA_exact</span>(design_result,</a>
<a class="sourceLine" id="cb170-2" title="2">                            <span class="dt">alpha_level =</span> alpha_level,</a>
<a class="sourceLine" id="cb170-3" title="3">                            <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-135">Table 3.10: </span>Exact ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
partial_eta_squared
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
SPEED
</td>
<td style="text-align:right;">
98.34682
</td>
<td style="text-align:right;">
0.1190476
</td>
<td style="text-align:right;">
0.3676073
</td>
<td style="text-align:right;">
20
</td>
</tr>
</tbody>
</table>
<p>Again, this is similar to GPower for the ANOVA:</p>
<p><a href="screenshots/gpower_4.png"></a></p>
</div>
</div>
<div id="part-4" class="section level2">
<h2><span class="header-section-number">3.4</span> Part 4</h2>
<div id="x2-anova-within-within-design" class="section level3">
<h3><span class="header-section-number">3.4.1</span> 2x2 ANOVA, within-within design</h3>
<p>We can simulate a 2x2 ANOVA, both factors manipulated within participants, with a specific sample size and effect size, to achieve a desired statistical power.</p>
<p>As <span class="citation">Potvin and Schutz (<a href="#ref-potvin2000statistical">2000</a>)</span> explain, analytic procedures for a two-factor repeated measures ANOVA do not seem to exist. The main problem is quantifying the error variance (the denominator when calculating lambda or Cohenâs <em>f</em>). Simulation based aproaches provide a solution.</p>
<p>We can reproduce the simulation coded by <a href="https://cognitivedatascientist.com/2015/12/14/power-simulation-in-r-the-repeated-measures-anova-5/">Ben Amsel</a></p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" title="1"><span class="co"># define the parameters</span></a>
<a class="sourceLine" id="cb171-2" title="2"><span class="co"># true effects (in this case, a double dissociation)</span></a>
<a class="sourceLine" id="cb171-3" title="3">mu =<span class="st"> </span><span class="kw">c</span>(<span class="dv">700</span>, <span class="dv">670</span>, <span class="dv">670</span>, <span class="dv">700</span>) </a>
<a class="sourceLine" id="cb171-4" title="4">sigma =<span class="st"> </span><span class="dv">150</span>  <span class="co"># population standard deviation</span></a>
<a class="sourceLine" id="cb171-5" title="5">rho =<span class="st"> </span><span class="fl">0.75</span> <span class="co"># correlation between repeated measures</span></a>
<a class="sourceLine" id="cb171-6" title="6">nsubs =<span class="st"> </span><span class="dv">25</span> <span class="co"># how many subjects?</span></a>
<a class="sourceLine" id="cb171-7" title="7">nsims =<span class="st"> </span>nsims <span class="co"># how many simulation replicates?</span></a>
<a class="sourceLine" id="cb171-8" title="8"> </a>
<a class="sourceLine" id="cb171-9" title="9"><span class="co"># create 2 factors representing the 2 independent variables</span></a>
<a class="sourceLine" id="cb171-10" title="10">cond =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">X1 =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]), nsubs <span class="op">*</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb171-11" title="11">                  <span class="dt">X2 =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]), nsubs, <span class="dt">each =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb171-12" title="12"> </a>
<a class="sourceLine" id="cb171-13" title="13"><span class="co"># create a subjects factor</span></a>
<a class="sourceLine" id="cb171-14" title="14">subject =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">sort</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>nsubs, <span class="dv">4</span>)))</a>
<a class="sourceLine" id="cb171-15" title="15"> </a>
<a class="sourceLine" id="cb171-16" title="16"><span class="co"># combine above into the design matrix</span></a>
<a class="sourceLine" id="cb171-17" title="17">dm =<span class="st"> </span><span class="kw">data.frame</span>(subject, cond)</a></code></pre></div>
<p>Build Sigma: the population variance-covariance matrix</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" title="1"><span class="co"># create k x k matrix populated with sigma</span></a>
<a class="sourceLine" id="cb172-2" title="2">sigma.mat &lt;-<span class="st"> </span><span class="kw">rep</span>(sigma, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb172-3" title="3">S &lt;-</a>
<a class="sourceLine" id="cb172-4" title="4"><span class="st">  </span><span class="kw">matrix</span>(sigma.mat,</a>
<a class="sourceLine" id="cb172-5" title="5">  <span class="dt">ncol =</span> <span class="kw">length</span>(sigma.mat),</a>
<a class="sourceLine" id="cb172-6" title="6">  <span class="dt">nrow =</span> <span class="kw">length</span>(sigma.mat))</a>
<a class="sourceLine" id="cb172-7" title="7"> </a>
<a class="sourceLine" id="cb172-8" title="8"><span class="co"># compute covariance between measures</span></a>
<a class="sourceLine" id="cb172-9" title="9">Sigma &lt;-<span class="st"> </span><span class="kw">t</span>(S) <span class="op">*</span><span class="st"> </span>S <span class="op">*</span><span class="st"> </span>rho  </a>
<a class="sourceLine" id="cb172-10" title="10"> </a>
<a class="sourceLine" id="cb172-11" title="11"><span class="co"># put the variances on the diagonal </span></a>
<a class="sourceLine" id="cb172-12" title="12"><span class="kw">diag</span>(Sigma) &lt;-<span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span>  </a></code></pre></div>
<p>Run the simulation</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" title="1"><span class="co"># stack &#39;nsims&#39; individual data frames into one large data frame</span></a>
<a class="sourceLine" id="cb173-2" title="2">df =<span class="st"> </span>dm[<span class="kw">rep</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(dm)), nsims), ]</a>
<a class="sourceLine" id="cb173-3" title="3"> </a>
<a class="sourceLine" id="cb173-4" title="4"><span class="co"># add an index column to track the simulation run</span></a>
<a class="sourceLine" id="cb173-5" title="5">df<span class="op">$</span>simID =<span class="st"> </span><span class="kw">sort</span>(<span class="kw">rep</span>(<span class="kw">seq_len</span>(nsims), <span class="kw">nrow</span>(dm)))</a>
<a class="sourceLine" id="cb173-6" title="6"> </a>
<a class="sourceLine" id="cb173-7" title="7"><span class="co"># sample the observed data from a multivariate normal distribution</span></a>
<a class="sourceLine" id="cb173-8" title="8"><span class="co"># using MASS::mvrnorm with the mu and Sigma created earlier</span></a>
<a class="sourceLine" id="cb173-9" title="9"><span class="co"># and bind to the existing df</span></a>
<a class="sourceLine" id="cb173-10" title="10"> </a>
<a class="sourceLine" id="cb173-11" title="11"></a>
<a class="sourceLine" id="cb173-12" title="12">make.y =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">as.vector</span>(<span class="kw">t</span>(<span class="kw">mvrnorm</span>(nsubs, mu, Sigma))))</a>
<a class="sourceLine" id="cb173-13" title="13">df<span class="op">$</span>y =<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">replicate</span>(nsims, <span class="kw">eval</span>(make.y)))             </a>
<a class="sourceLine" id="cb173-14" title="14"> </a>
<a class="sourceLine" id="cb173-15" title="15"><span class="co"># use do(), the general purpose complement to the specialized data </span></a>
<a class="sourceLine" id="cb173-16" title="16"><span class="co"># manipulation functions available in dplyr, to run the ANOVA on</span></a>
<a class="sourceLine" id="cb173-17" title="17"><span class="co"># each section of the grouped data frame created by group_by</span></a>
<a class="sourceLine" id="cb173-18" title="18"> </a>
<a class="sourceLine" id="cb173-19" title="19"></a>
<a class="sourceLine" id="cb173-20" title="20">mods &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb173-21" title="21"><span class="st">  </span><span class="kw">group_by</span>(simID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb173-22" title="22"><span class="st">  </span><span class="kw">do</span>(<span class="dt">model =</span> <span class="kw">aov</span>(y <span class="op">~</span><span class="st"> </span>X1 <span class="op">*</span><span class="st"> </span>X2 <span class="op">+</span><span class="st"> </span><span class="kw">Error</span>(subject <span class="op">/</span><span class="st"> </span>(X1 <span class="op">*</span><span class="st"> </span>X2)), </a>
<a class="sourceLine" id="cb173-23" title="23">                 <span class="dt">qr =</span> <span class="ot">FALSE</span>, <span class="dt">data =</span> .)) </a>
<a class="sourceLine" id="cb173-24" title="24"> </a>
<a class="sourceLine" id="cb173-25" title="25"><span class="co"># extract p-values for each effect and store in a data frame</span></a>
<a class="sourceLine" id="cb173-26" title="26">p_val_<span class="dv">1</span> =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb173-27" title="27">  mods <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do</span>(<span class="kw">as.data.frame</span>(<span class="kw">tidy</span>(.<span class="op">$</span>model[[<span class="dv">3</span>]])<span class="op">$</span>p.value[<span class="dv">1</span>])),</a>
<a class="sourceLine" id="cb173-28" title="28">  mods <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do</span>(<span class="kw">as.data.frame</span>(<span class="kw">tidy</span>(.<span class="op">$</span>model[[<span class="dv">4</span>]])<span class="op">$</span>p.value[<span class="dv">1</span>])),</a>
<a class="sourceLine" id="cb173-29" title="29">  mods <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do</span>(<span class="kw">as.data.frame</span>(<span class="kw">tidy</span>(.<span class="op">$</span>model[[<span class="dv">5</span>]])<span class="op">$</span>p.value[<span class="dv">1</span>])))</a>
<a class="sourceLine" id="cb173-30" title="30"><span class="kw">colnames</span>(p_val_<span class="dv">1</span>) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;X1&#39;</span>,<span class="st">&#39;X2&#39;</span>,<span class="st">&#39;Interaction&#39;</span>)</a></code></pre></div>
<p>The empirical power is easy to compute, itâs just the proportion of simulation runs where <em>p</em> &lt; .05.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" title="1">power.res =<span class="st"> </span><span class="kw">apply</span>(<span class="kw">as.matrix</span>(p_val_<span class="dv">1</span>), <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb174-2" title="2">  <span class="cf">function</span>(x) <span class="kw">round</span>(<span class="kw">mean</span>(<span class="kw">ifelse</span>(x <span class="op">&lt;</span><span class="st"> </span><span class="fl">.05</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>),<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb174-3" title="3">power.res</a></code></pre></div>
<pre><code>##          X1          X2 Interaction 
##        4.80        4.66       47.50</code></pre>
<p>Visualize the distributions of <em>p</em>-values</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb176-1" title="1"><span class="co"># plot the known effects</span></a>
<a class="sourceLine" id="cb176-2" title="2"></a>
<a class="sourceLine" id="cb176-3" title="3"> </a>
<a class="sourceLine" id="cb176-4" title="4">means =<span class="st"> </span><span class="kw">data.frame</span>(cond[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,], mu, <span class="dt">SE =</span> sigma <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(nsubs))</a>
<a class="sourceLine" id="cb176-5" title="5">plt1 =<span class="st"> </span><span class="kw">ggplot</span>(means, <span class="kw">aes</span>(<span class="dt">y =</span> mu, <span class="dt">x =</span> X1, <span class="dt">fill =</span> X2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-6" title="6"><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-7" title="7"><span class="kw">geom_errorbar</span>(</a>
<a class="sourceLine" id="cb176-8" title="8"><span class="kw">aes</span>(<span class="dt">ymin =</span> mu <span class="op">-</span><span class="st"> </span>SE, <span class="dt">ymax =</span> mu <span class="op">+</span><span class="st"> </span>SE),</a>
<a class="sourceLine" id="cb176-9" title="9"><span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.9</span>),</a>
<a class="sourceLine" id="cb176-10" title="10"><span class="dt">size =</span> <span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb176-11" title="11"><span class="dt">width =</span> <span class="fl">.3</span></a>
<a class="sourceLine" id="cb176-12" title="12">) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-13" title="13"><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>((.<span class="dv">7</span> <span class="op">*</span><span class="st"> </span><span class="kw">min</span>(mu)), <span class="fl">1.2</span> <span class="op">*</span><span class="st"> </span><span class="kw">max</span>(mu))) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-14" title="14"><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb176-15" title="15"></a>
<a class="sourceLine" id="cb176-16" title="16"><span class="co"># melt the data into a ggplot friendly &#39;long&#39; format</span></a>
<a class="sourceLine" id="cb176-17" title="17"></a>
<a class="sourceLine" id="cb176-18" title="18">plotData &lt;-<span class="st"> </span><span class="kw">melt</span>(p_val_<span class="dv">1</span>, <span class="dt">value.name =</span> <span class="st">&#39;p&#39;</span>)</a>
<a class="sourceLine" id="cb176-19" title="19"></a>
<a class="sourceLine" id="cb176-20" title="20"><span class="co"># plot each of the p-value distributions on a log scale</span></a>
<a class="sourceLine" id="cb176-21" title="21"><span class="kw">options</span>(<span class="dt">scipen =</span> <span class="dv">999</span>) <span class="co"># &#39;turn off&#39; scientific notation</span></a>
<a class="sourceLine" id="cb176-22" title="22">plt2 =<span class="st"> </span><span class="kw">ggplot</span>(plotData, <span class="kw">aes</span>(<span class="dt">x =</span> p)) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-23" title="23"><span class="kw">scale_x_log10</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.05</span>, <span class="fl">0.001</span>),</a>
<a class="sourceLine" id="cb176-24" title="24"><span class="dt">labels =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.05</span>, <span class="fl">0.001</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-25" title="25"><span class="kw">geom_histogram</span>(<span class="dt">colour =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-26" title="26"><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">0.05</span>, <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-27" title="27"><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-28" title="28"><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(Log[<span class="dv">10</span>] <span class="op">~</span><span class="st"> </span>P)) <span class="op">+</span></a>
<a class="sourceLine" id="cb176-29" title="29"><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">size =</span> <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb176-30" title="30"></a>
<a class="sourceLine" id="cb176-31" title="31"><span class="co"># arrange plots side by side and print</span></a>
<a class="sourceLine" id="cb176-32" title="32"><span class="kw">grid.arrange</span>(plt1, plt2, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="SuperpowerValidation_files/figure-html/unnamed-chunk-141-1.png" width="672" /></p>
<p>We can reproduce this simulation:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb177-1" title="1"><span class="co"># true effects (in this case, a double dissociation)</span></a>
<a class="sourceLine" id="cb177-2" title="2">mu =<span class="st"> </span><span class="kw">c</span>(<span class="dv">700</span>, <span class="dv">670</span>, <span class="dv">670</span>, <span class="dv">700</span>) </a>
<a class="sourceLine" id="cb177-3" title="3">sigma =<span class="st"> </span><span class="dv">150</span>  <span class="co"># population standard deviation</span></a>
<a class="sourceLine" id="cb177-4" title="4">n &lt;-<span class="st"> </span><span class="dv">25</span></a>
<a class="sourceLine" id="cb177-5" title="5">sd &lt;-<span class="st"> </span><span class="dv">150</span></a>
<a class="sourceLine" id="cb177-6" title="6">r &lt;-<span class="st"> </span><span class="fl">0.75</span></a>
<a class="sourceLine" id="cb177-7" title="7">string =<span class="st"> &quot;2w*2w&quot;</span></a>
<a class="sourceLine" id="cb177-8" title="8">alpha_level &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb177-9" title="9">labelnames =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;age&quot;</span>, <span class="st">&quot;old&quot;</span>, <span class="st">&quot;young&quot;</span>, <span class="st">&quot;color&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb177-10" title="10">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> string,</a>
<a class="sourceLine" id="cb177-11" title="11">                              <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb177-12" title="12">                              <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb177-13" title="13">                              <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb177-14" title="14">                              <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb177-15" title="15">                              <span class="dt">labelnames =</span> labelnames)</a></code></pre></div>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb178-1" title="1">simulation_result &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, </a>
<a class="sourceLine" id="cb178-2" title="2">                                 <span class="dt">alpha_level =</span> alpha_level, </a>
<a class="sourceLine" id="cb178-3" title="3">                                 <span class="dt">nsims =</span> nsims,</a>
<a class="sourceLine" id="cb178-4" title="4">                                 <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-144">Table 3.11: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_age
</td>
<td style="text-align:right;">
4.99
</td>
<td style="text-align:right;">
0.0396351
</td>
</tr>
<tr>
<td style="text-align:left;">
anova_color
</td>
<td style="text-align:right;">
5.17
</td>
<td style="text-align:right;">
0.0405810
</td>
</tr>
<tr>
<td style="text-align:left;">
anova_age:color
</td>
<td style="text-align:right;">
47.80
</td>
<td style="text-align:right;">
0.1641690
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb179-1" title="1">exact_result &lt;-<span class="st"> </span><span class="kw">ANOVA_exact</span>(design_result,</a>
<a class="sourceLine" id="cb179-2" title="2">                            <span class="dt">alpha_level =</span> alpha_level,</a>
<a class="sourceLine" id="cb179-3" title="3">                            <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-146">Table 3.12: </span>Exact ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
partial_eta_squared
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
5.00000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
color
</td>
<td style="text-align:right;">
5.00000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
age:color
</td>
<td style="text-align:right;">
48.40183
</td>
<td style="text-align:right;">
0.1428571
</td>
<td style="text-align:right;">
0.4082483
</td>
<td style="text-align:right;">
4
</td>
</tr>
</tbody>
</table>
<p>The simulations yield closely matching results.</p>
</div>
<div id="examine-variation-of-means-and-correlation" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Examine variation of means and correlation</h3>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb180-1" title="1"><span class="co"># define the parameters</span></a>
<a class="sourceLine" id="cb180-2" title="2"><span class="co"># true effects (in this case, a double dissociation)</span></a>
<a class="sourceLine" id="cb180-3" title="3">mu =<span class="st"> </span><span class="kw">c</span>(<span class="dv">700</span>, <span class="dv">670</span>, <span class="dv">690</span>, <span class="dv">750</span>) </a>
<a class="sourceLine" id="cb180-4" title="4">sigma =<span class="st"> </span><span class="dv">150</span>  <span class="co"># population standard deviation</span></a>
<a class="sourceLine" id="cb180-5" title="5">rho =<span class="st"> </span><span class="fl">0.4</span> <span class="co"># correlation between repeated measures</span></a>
<a class="sourceLine" id="cb180-6" title="6">nsubs =<span class="st"> </span><span class="dv">25</span> <span class="co"># how many subjects?</span></a>
<a class="sourceLine" id="cb180-7" title="7">nsims =<span class="st"> </span>nsims <span class="co"># how many simulation replicates?</span></a>
<a class="sourceLine" id="cb180-8" title="8"> </a>
<a class="sourceLine" id="cb180-9" title="9"><span class="co"># create 2 factors representing the 2 independent variables</span></a>
<a class="sourceLine" id="cb180-10" title="10">cond =<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">X1 =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]), nsubs <span class="op">*</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb180-11" title="11"><span class="dt">X2 =</span> <span class="kw">rep</span>(<span class="kw">factor</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]), nsubs, <span class="dt">each =</span> <span class="dv">2</span>))</a>
<a class="sourceLine" id="cb180-12" title="12"> </a>
<a class="sourceLine" id="cb180-13" title="13"><span class="co"># create a subjects factor</span></a>
<a class="sourceLine" id="cb180-14" title="14">subject =<span class="st"> </span><span class="kw">factor</span>(<span class="kw">sort</span>(<span class="kw">rep</span>(<span class="dv">1</span><span class="op">:</span>nsubs, <span class="dv">4</span>)))</a>
<a class="sourceLine" id="cb180-15" title="15"> </a>
<a class="sourceLine" id="cb180-16" title="16"><span class="co"># combine above into the design matrix</span></a>
<a class="sourceLine" id="cb180-17" title="17">dm =<span class="st"> </span><span class="kw">data.frame</span>(subject, cond)</a></code></pre></div>
<p>Build Sigma: the population variance-covariance matrix</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb181-1" title="1"><span class="co"># create k x k matrix populated with sigma</span></a>
<a class="sourceLine" id="cb181-2" title="2">sigma.mat &lt;-<span class="st"> </span><span class="kw">rep</span>(sigma, <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb181-3" title="3">S &lt;-</a>
<a class="sourceLine" id="cb181-4" title="4"><span class="kw">matrix</span>(sigma.mat,</a>
<a class="sourceLine" id="cb181-5" title="5"><span class="dt">ncol =</span> <span class="kw">length</span>(sigma.mat),</a>
<a class="sourceLine" id="cb181-6" title="6"><span class="dt">nrow =</span> <span class="kw">length</span>(sigma.mat))</a>
<a class="sourceLine" id="cb181-7" title="7"></a>
<a class="sourceLine" id="cb181-8" title="8"><span class="co"># compute covariance between measures</span></a>
<a class="sourceLine" id="cb181-9" title="9">Sigma &lt;-<span class="st"> </span><span class="kw">t</span>(S) <span class="op">*</span><span class="st"> </span>S <span class="op">*</span><span class="st"> </span>rho</a>
<a class="sourceLine" id="cb181-10" title="10"></a>
<a class="sourceLine" id="cb181-11" title="11"><span class="co"># put the variances on the diagonal</span></a>
<a class="sourceLine" id="cb181-12" title="12"><span class="kw">diag</span>(Sigma) &lt;-<span class="st"> </span>sigma <span class="op">^</span><span class="st"> </span><span class="dv">2</span>  </a></code></pre></div>
<p>Run the simulation</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb182-1" title="1"><span class="co"># stack &#39;nsims&#39; individual data frames into one large data frame</span></a>
<a class="sourceLine" id="cb182-2" title="2">df =<span class="st"> </span>dm[<span class="kw">rep</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(dm)), nsims), ]</a>
<a class="sourceLine" id="cb182-3" title="3"> </a>
<a class="sourceLine" id="cb182-4" title="4"><span class="co"># add an index column to track the simulation run</span></a>
<a class="sourceLine" id="cb182-5" title="5">df<span class="op">$</span>simID =<span class="st"> </span><span class="kw">sort</span>(<span class="kw">rep</span>(<span class="kw">seq_len</span>(nsims), <span class="kw">nrow</span>(dm)))</a>
<a class="sourceLine" id="cb182-6" title="6"> </a>
<a class="sourceLine" id="cb182-7" title="7"><span class="co"># sample the observed data from a multivariate normal distribution</span></a>
<a class="sourceLine" id="cb182-8" title="8"><span class="co"># using MASS::mvrnorm with the mu and Sigma created earlier</span></a>
<a class="sourceLine" id="cb182-9" title="9"><span class="co"># and bind to the existing df</span></a>
<a class="sourceLine" id="cb182-10" title="10"> </a>
<a class="sourceLine" id="cb182-11" title="11"></a>
<a class="sourceLine" id="cb182-12" title="12">make.y =<span class="st"> </span><span class="kw">expression</span>(<span class="kw">as.vector</span>(<span class="kw">t</span>(<span class="kw">mvrnorm</span>(nsubs, mu, Sigma))))</a>
<a class="sourceLine" id="cb182-13" title="13">df<span class="op">$</span>y =<span class="st"> </span><span class="kw">as.vector</span>(<span class="kw">replicate</span>(nsims, <span class="kw">eval</span>(make.y)))             </a>
<a class="sourceLine" id="cb182-14" title="14"> </a>
<a class="sourceLine" id="cb182-15" title="15"><span class="co"># use do(), the general purpose complement to the specialized data </span></a>
<a class="sourceLine" id="cb182-16" title="16"><span class="co"># manipulation functions available in dplyr, to run the ANOVA on</span></a>
<a class="sourceLine" id="cb182-17" title="17"><span class="co"># each section of the grouped data frame created by group_by</span></a>
<a class="sourceLine" id="cb182-18" title="18"> </a>
<a class="sourceLine" id="cb182-19" title="19"></a>
<a class="sourceLine" id="cb182-20" title="20">mods &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-21" title="21"><span class="st">  </span><span class="kw">group_by</span>(simID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb182-22" title="22"><span class="st">  </span><span class="kw">do</span>(<span class="dt">model =</span> <span class="kw">aov</span>(y <span class="op">~</span><span class="st"> </span>X1 <span class="op">*</span><span class="st"> </span>X2 <span class="op">+</span><span class="st"> </span><span class="kw">Error</span>(subject <span class="op">/</span><span class="st"> </span>(X1 <span class="op">*</span><span class="st"> </span>X2)), </a>
<a class="sourceLine" id="cb182-23" title="23">                 <span class="dt">qr =</span> <span class="ot">FALSE</span>, <span class="dt">data =</span> .))</a>
<a class="sourceLine" id="cb182-24" title="24">  </a>
<a class="sourceLine" id="cb182-25" title="25">  <span class="co"># extract p-values for each effect and store in a data frame</span></a>
<a class="sourceLine" id="cb182-26" title="26">  p_val_<span class="dv">2</span> =<span class="st"> </span><span class="kw">data.frame</span>(mods <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb182-27" title="27"><span class="st">                   </span><span class="kw">do</span>(<span class="kw">as.data.frame</span>(<span class="kw">tidy</span>(.<span class="op">$</span>model[[<span class="dv">3</span>]])<span class="op">$</span>p.value[<span class="dv">1</span>])),</a>
<a class="sourceLine" id="cb182-28" title="28">  mods <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do</span>(<span class="kw">as.data.frame</span>(<span class="kw">tidy</span>(.<span class="op">$</span>model[[<span class="dv">4</span>]])<span class="op">$</span>p.value[<span class="dv">1</span>])),</a>
<a class="sourceLine" id="cb182-29" title="29">  mods <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">do</span>(<span class="kw">as.data.frame</span>(<span class="kw">tidy</span>(.<span class="op">$</span>model[[<span class="dv">5</span>]])<span class="op">$</span>p.value[<span class="dv">1</span>])))</a>
<a class="sourceLine" id="cb182-30" title="30">  <span class="kw">colnames</span>(p_val_<span class="dv">2</span>) =<span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;X1&#39;</span>, <span class="st">&#39;X2&#39;</span>, <span class="st">&#39;Interaction&#39;</span>)</a></code></pre></div>
<p>The empirical power is easy to compute, itâs just the proportion of simulation runs where p &lt;. 05.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb183-1" title="1">power.res =<span class="st"> </span><span class="kw">apply</span>(<span class="kw">as.matrix</span>(p_val_<span class="dv">2</span>), <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb183-2" title="2">  <span class="cf">function</span>(x) <span class="kw">round</span>(<span class="kw">mean</span>(<span class="kw">ifelse</span>(x <span class="op">&lt;</span><span class="st"> </span><span class="fl">.05</span>, <span class="dv">1</span>, <span class="dv">0</span>) <span class="op">*</span><span class="st"> </span><span class="dv">100</span>),<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb183-3" title="3">power.res</a></code></pre></div>
<pre><code>##          X1          X2 Interaction 
##        9.47       30.17       46.45</code></pre>
<p>Visualize the distributions of <em>p</em>-values</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb185-1" title="1">means =<span class="st"> </span><span class="kw">data.frame</span>(cond[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,], mu, <span class="dt">SE =</span> sigma <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(nsubs))</a>
<a class="sourceLine" id="cb185-2" title="2">plt1 =<span class="st"> </span><span class="kw">ggplot</span>(means, <span class="kw">aes</span>(<span class="dt">y =</span> mu, <span class="dt">x =</span> X1, <span class="dt">fill =</span> X2)) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-3" title="3"><span class="kw">geom_bar</span>(<span class="dt">position =</span> <span class="kw">position_dodge</span>(), <span class="dt">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-4" title="4"><span class="kw">geom_errorbar</span>(</a>
<a class="sourceLine" id="cb185-5" title="5"><span class="kw">aes</span>(<span class="dt">ymin =</span> mu <span class="op">-</span><span class="st"> </span>SE, <span class="dt">ymax =</span> mu <span class="op">+</span><span class="st"> </span>SE),</a>
<a class="sourceLine" id="cb185-6" title="6"><span class="dt">position =</span> <span class="kw">position_dodge</span>(<span class="dt">width =</span> <span class="fl">0.9</span>),</a>
<a class="sourceLine" id="cb185-7" title="7"><span class="dt">size =</span> <span class="fl">.6</span>,</a>
<a class="sourceLine" id="cb185-8" title="8"><span class="dt">width =</span> <span class="fl">.3</span></a>
<a class="sourceLine" id="cb185-9" title="9">) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-10" title="10"><span class="kw">coord_cartesian</span>(<span class="dt">ylim =</span> <span class="kw">c</span>((.<span class="dv">7</span> <span class="op">*</span><span class="st"> </span><span class="kw">min</span>(mu)), <span class="fl">1.2</span> <span class="op">*</span><span class="st"> </span><span class="kw">max</span>(mu))) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-11" title="11"><span class="kw">theme_bw</span>()</a>
<a class="sourceLine" id="cb185-12" title="12"> </a>
<a class="sourceLine" id="cb185-13" title="13"><span class="co"># melt the data into a ggplot friendly &#39;long&#39; format</span></a>
<a class="sourceLine" id="cb185-14" title="14"></a>
<a class="sourceLine" id="cb185-15" title="15">plotData &lt;-<span class="st"> </span><span class="kw">melt</span>(p_val_<span class="dv">2</span>, <span class="dt">value.name =</span> <span class="st">&#39;p&#39;</span>)</a>
<a class="sourceLine" id="cb185-16" title="16"> </a>
<a class="sourceLine" id="cb185-17" title="17"><span class="co"># plot each of the p-value distributions on a log scale</span></a>
<a class="sourceLine" id="cb185-18" title="18"><span class="kw">options</span>(<span class="dt">scipen =</span> <span class="dv">999</span>) <span class="co"># &#39;turn off&#39; scientific notation</span></a>
<a class="sourceLine" id="cb185-19" title="19">plt2 =<span class="st"> </span><span class="kw">ggplot</span>(plotData, <span class="kw">aes</span>(<span class="dt">x =</span> p)) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-20" title="20"><span class="kw">scale_x_log10</span>(<span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.05</span>, <span class="fl">0.001</span>),</a>
<a class="sourceLine" id="cb185-21" title="21"><span class="dt">labels =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="fl">0.05</span>, <span class="fl">0.001</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-22" title="22"><span class="kw">geom_histogram</span>(<span class="dt">colour =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="dt">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-23" title="23"><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> <span class="fl">0.05</span>, <span class="dt">colour =</span> <span class="st">&#39;red&#39;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-24" title="24"><span class="kw">facet_grid</span>(variable <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-25" title="25"><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(Log[<span class="dv">10</span>] <span class="op">~</span><span class="st"> </span>P)) <span class="op">+</span></a>
<a class="sourceLine" id="cb185-26" title="26"><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">color =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">size =</span> <span class="dv">7</span>))</a>
<a class="sourceLine" id="cb185-27" title="27"></a>
<a class="sourceLine" id="cb185-28" title="28"><span class="co"># arrange plots side by side and print</span></a>
<a class="sourceLine" id="cb185-29" title="29"><span class="kw">grid.arrange</span>(plt1, plt2, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="SuperpowerValidation_files/figure-html/unnamed-chunk-151-1.png" width="672" /></p>
<p>We can reproduce this simulation:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb186-1" title="1"><span class="co"># true effects (in this case, a double dissociation)</span></a>
<a class="sourceLine" id="cb186-2" title="2">mu =<span class="st"> </span><span class="kw">c</span>(<span class="dv">700</span>, <span class="dv">670</span>, <span class="dv">690</span>, <span class="dv">750</span>) </a>
<a class="sourceLine" id="cb186-3" title="3">sigma =<span class="st"> </span><span class="dv">150</span>  <span class="co"># population standard deviation</span></a>
<a class="sourceLine" id="cb186-4" title="4">n &lt;-<span class="st"> </span><span class="dv">25</span></a>
<a class="sourceLine" id="cb186-5" title="5">sd &lt;-<span class="st"> </span><span class="dv">150</span></a>
<a class="sourceLine" id="cb186-6" title="6">r &lt;-<span class="st"> </span><span class="fl">0.4</span></a>
<a class="sourceLine" id="cb186-7" title="7">string =<span class="st"> &quot;2w*2w&quot;</span></a>
<a class="sourceLine" id="cb186-8" title="8">alpha_level &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb186-9" title="9">labelnames =<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;AGE&quot;</span>, <span class="st">&quot;old&quot;</span>, <span class="st">&quot;young&quot;</span>, </a>
<a class="sourceLine" id="cb186-10" title="10">               <span class="st">&quot;COLOR&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb186-11" title="11"></a>
<a class="sourceLine" id="cb186-12" title="12">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> string,</a>
<a class="sourceLine" id="cb186-13" title="13">                              <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb186-14" title="14">                              <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb186-15" title="15">                              <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb186-16" title="16">                              <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb186-17" title="17">                              <span class="dt">labelnames =</span> labelnames)</a></code></pre></div>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb187-1" title="1">simulation_result &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, </a>
<a class="sourceLine" id="cb187-2" title="2">                                 <span class="dt">alpha_level =</span> <span class="fl">0.05</span>, </a>
<a class="sourceLine" id="cb187-3" title="3">                                 <span class="dt">nsims =</span> nsims)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-154">Table 3.13: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_AGE
</td>
<td style="text-align:right;">
30.60
</td>
<td style="text-align:right;">
0.1143202
</td>
</tr>
<tr>
<td style="text-align:left;">
anova_COLOR
</td>
<td style="text-align:right;">
9.41
</td>
<td style="text-align:right;">
0.0541130
</td>
</tr>
<tr>
<td style="text-align:left;">
anova_AGE:COLOR
</td>
<td style="text-align:right;">
46.22
</td>
<td style="text-align:right;">
0.1595391
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb188-1" title="1">exact_result &lt;-<span class="st"> </span><span class="kw">ANOVA_exact</span>(design_result, <span class="dt">alpha_level =</span> alpha_level)</a></code></pre></div>
<pre><code>## Power and Effect sizes for ANOVA tests
##             power partial_eta_squared cohen_f non_centrality
## AGE       30.4009              0.0864  0.3074         2.2685
## COLOR      9.5071              0.0171  0.1318         0.4167
## AGE:COLOR 45.9803              0.1351  0.3953         3.7500
## 
## Power and Effect sizes for contrasts
##                                            power effect_size
## p_AGE_old_COLOR_blue_AGE_old_COLOR_red     14.16     -0.1826
## p_AGE_old_COLOR_blue_AGE_young_COLOR_blue   5.98     -0.0609
## p_AGE_old_COLOR_blue_AGE_young_COLOR_red   30.91      0.3043
## p_AGE_old_COLOR_red_AGE_young_COLOR_blue    9.00      0.1217
## p_AGE_old_COLOR_red_AGE_young_COLOR_red    64.66      0.4869
## p_AGE_young_COLOR_blue_AGE_young_COLOR_red 41.80      0.3651</code></pre>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-156">Table 3.14: </span>Exact ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
partial_eta_squared
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AGE
</td>
<td style="text-align:right;">
30.400885
</td>
<td style="text-align:right;">
0.0863588
</td>
<td style="text-align:right;">
0.3074437
</td>
<td style="text-align:right;">
2.2685185
</td>
</tr>
<tr>
<td style="text-align:left;">
COLOR
</td>
<td style="text-align:right;">
9.507147
</td>
<td style="text-align:right;">
0.0170648
</td>
<td style="text-align:right;">
0.1317616
</td>
<td style="text-align:right;">
0.4166667
</td>
</tr>
<tr>
<td style="text-align:left;">
AGE:COLOR
</td>
<td style="text-align:right;">
45.980305
</td>
<td style="text-align:right;">
0.1351351
</td>
<td style="text-align:right;">
0.3952847
</td>
<td style="text-align:right;">
3.7500000
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="part-5" class="section level2">
<h2><span class="header-section-number">3.5</span> Part 5</h2>
<p><strong>Credit for the non-centrality parameter for the interaction goes to Andrew Vigotsky</strong></p>
<div id="x2-anova-within-design" class="section level3">
<h3><span class="header-section-number">3.5.1</span> 2x2 ANOVA, within design</h3>
<p><span class="citation">Potvin and Schutz (<a href="#ref-potvin2000statistical">2000</a>)</span> simulate a wide range of repeated measure designs. They give an example of a 3x3 design, with the following correlation matrix:</p>
<p><img src="screenshots/PS2000.png" /></p>
<p>Variances were set to 1 (so all covariance matrices in their simulations were identical). In this specific example, the white fields are related to the correlation for the A main effect (these cells have the same level for B, but different levels of A). The grey cells are related to the main effect of B (the cells have the same level of A, but different levels of B). Finally, the black cells are related to the AxB interaction (they have different levels of A and B). The diagonal (all 1) relate to cells with the same levels of A and B.</p>
<p><span class="citation">Potvin and Schutz (<a href="#ref-potvin2000statistical">2000</a>)</span> examine power for 2x2 within ANOVA designs and develop approximations of the error variance. For a design with 2 within factors (A and B) these are:</p>
<p>For the main effect of A:
<span class="math inline">\(\sigma _ { e } ^ { 2 } = \sigma ^ { 2 } ( 1 - \overline { \rho } _ { A } ) + \sigma ^ { 2 } ( q - 1 ) ( \overline { \rho } _ { B } - \overline { \rho } _ { AB } )\)</span></p>
<p>For the main effectof B:
<span class="math inline">\(\sigma _ { e } ^ { 2 } = \sigma ^ { 2 } ( 1 - \overline { \rho } _ { B } ) + \sigma ^ { 2 } ( p - 1 ) ( \overline { \rho } _ { A } - \overline { \rho } _ { A B } )\)</span></p>
<p>For the interaction between A and B:
<span class="math inline">\(\sigma _ { e } ^ { 2 } = \sigma ^ { 2 } ( 1 - \rho _ { \max } ) - \sigma ^ { 2 } ( \overline { \rho } _ { \min } - \overline { \rho } _ { AB } )\)</span></p>
<p>Letâs now compare the formulas in <span class="citation">Potvin and Schutz (<a href="#ref-potvin2000statistical">2000</a>)</span> with <code>Superpower</code> with a simple scenario.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb190-1" title="1">mu =<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">2</span>) </a>
<a class="sourceLine" id="cb190-2" title="2">n &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb190-3" title="3">sd &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb190-4" title="4">r &lt;-<span class="st"> </span><span class="fl">.77</span></a>
<a class="sourceLine" id="cb190-5" title="5">string =<span class="st"> &quot;2w*2w&quot;</span></a>
<a class="sourceLine" id="cb190-6" title="6">alpha_level &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb190-7" title="7"></a>
<a class="sourceLine" id="cb190-8" title="8"></a>
<a class="sourceLine" id="cb190-9" title="9">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> string,</a>
<a class="sourceLine" id="cb190-10" title="10">                              <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb190-11" title="11">                              <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb190-12" title="12">                              <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb190-13" title="13">                              <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb190-14" title="14">                              <span class="dt">labelnames =</span> labelnames,</a>
<a class="sourceLine" id="cb190-15" title="15">                              <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="SuperpowerValidation_files/figure-html/unnamed-chunk-157-1.png" width="672" /></p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb191-1" title="1">design_result<span class="op">$</span>cor_mat</a></code></pre></div>
<pre><code>##            old_blue old_red young_blue young_red
## old_blue       1.00    0.77       0.77      0.77
## old_red        0.77    1.00       0.77      0.77
## young_blue     0.77    0.77       1.00      0.77
## young_red      0.77    0.77       0.77      1.00</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb193-1" title="1">exact_result &lt;-<span class="st"> </span><span class="kw">ANOVA_exact</span>(design_result,</a>
<a class="sourceLine" id="cb193-2" title="2">                            <span class="dt">alpha_level =</span> alpha_level,</a>
<a class="sourceLine" id="cb193-3" title="3">                            <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-159">Table 3.15: </span>Exact ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
partial_eta_squared
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
AGE
</td>
<td style="text-align:right;">
75.61412
</td>
<td style="text-align:right;">
0.2917342
</td>
<td style="text-align:right;">
0.6417938
</td>
<td style="text-align:right;">
7.8260870
</td>
</tr>
<tr>
<td style="text-align:left;">
COLOR
</td>
<td style="text-align:right;">
75.61412
</td>
<td style="text-align:right;">
0.2917342
</td>
<td style="text-align:right;">
0.6417938
</td>
<td style="text-align:right;">
7.8260870
</td>
</tr>
<tr>
<td style="text-align:left;">
AGE:COLOR
</td>
<td style="text-align:right;">
14.36376
</td>
<td style="text-align:right;">
0.0437637
</td>
<td style="text-align:right;">
0.2139313
</td>
<td style="text-align:right;">
0.8695652
</td>
</tr>
</tbody>
</table>
<p>Further, as we use the analytical solution below, the variance components should be equal to the corresponding MSE from the <code>ANOVA_exact</code> produced <code>anova_table</code> object.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb194-1" title="1">exact_result<span class="op">$</span>aov_result<span class="op">$</span>anova_table</a></code></pre></div>
<pre><code>## Anova Table (Type 3 tests)
## 
## Response: y
##           num Df den Df  MSE      F      pes  Pr(&gt;F)  
## AGE            1     19 5.75 7.8261 0.291734 0.01149 *
## COLOR          1     19 5.75 7.8261 0.291734 0.01149 *
## AGE:COLOR      1     19 5.75 0.8696 0.043764 0.36278  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>We can try to use the formula in <span class="citation">Potvin and Schutz (<a href="#ref-potvin2000statistical">2000</a>)</span>.</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb196-1" title="1">k &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co">#one group (because all factors are within)</span></a>
<a class="sourceLine" id="cb196-2" title="2"></a>
<a class="sourceLine" id="cb196-3" title="3">rho_A &lt;-<span class="st"> </span><span class="fl">.77</span> <span class="co">#mean r for factor A</span></a>
<a class="sourceLine" id="cb196-4" title="4"></a>
<a class="sourceLine" id="cb196-5" title="5">rho_B &lt;-<span class="st"> </span><span class="fl">.77</span> <span class="co">#mean r for factor B</span></a>
<a class="sourceLine" id="cb196-6" title="6"></a>
<a class="sourceLine" id="cb196-7" title="7">rho_AB &lt;-<span class="st"> </span><span class="fl">.77</span> <span class="co">#mean r for factor AB</span></a>
<a class="sourceLine" id="cb196-8" title="8"></a>
<a class="sourceLine" id="cb196-9" title="9">alpha &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb196-10" title="10"></a>
<a class="sourceLine" id="cb196-11" title="11">sigma &lt;-<span class="st"> </span>sd</a>
<a class="sourceLine" id="cb196-12" title="12"></a>
<a class="sourceLine" id="cb196-13" title="13">m_A &lt;-<span class="st"> </span><span class="dv">2</span> <span class="co">#levels factor A</span></a>
<a class="sourceLine" id="cb196-14" title="14"></a>
<a class="sourceLine" id="cb196-15" title="15">variance_e_A &lt;-<span class="st"> </span>(sigma<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rho_A) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb196-16" title="16"><span class="st">  </span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(rho_B <span class="op">-</span><span class="st"> </span>rho_AB) )</a>
<a class="sourceLine" id="cb196-17" title="17"><span class="co">#Variance A</span></a>
<a class="sourceLine" id="cb196-18" title="18">variance_e_A</a></code></pre></div>
<pre><code>## [1] 5.75</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb198-1" title="1">m_B &lt;-<span class="st"> </span><span class="dv">2</span> <span class="co">#levels factor B</span></a>
<a class="sourceLine" id="cb198-2" title="2"></a>
<a class="sourceLine" id="cb198-3" title="3">variance_e_B &lt;-<span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rho_B) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb198-4" title="4"><span class="st">  </span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(rho_A <span class="op">-</span><span class="st"> </span>rho_AB)</a>
<a class="sourceLine" id="cb198-5" title="5"><span class="co">#Variance B</span></a>
<a class="sourceLine" id="cb198-6" title="6">variance_e_B</a></code></pre></div>
<pre><code>## [1] 5.75</code></pre>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb200-1" title="1">variance_e_AB &lt;-</a>
<a class="sourceLine" id="cb200-2" title="2"><span class="st">  </span>(sigma <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">max</span>(rho_A, rho_B)) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb200-3" title="3"><span class="st">     </span>sigma <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">min</span>(rho_A,rho_B) <span class="op">-</span><span class="st"> </span>rho_AB)) </a>
<a class="sourceLine" id="cb200-4" title="4"><span class="co">#Variance AB</span></a>
<a class="sourceLine" id="cb200-5" title="5">variance_e_AB</a></code></pre></div>
<pre><code>## [1] 5.75</code></pre>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb202-1" title="1"><span class="co">#Create a mean matrix</span></a>
<a class="sourceLine" id="cb202-2" title="2">mean_mat &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">matrix</span>(mu, <span class="dt">nrow =</span> m_B,<span class="dt">ncol =</span> m_A)) </a>
<a class="sourceLine" id="cb202-3" title="3">mean_mat</a></code></pre></div>
<pre><code>##      [,1] [,2]
## [1,]    2    1
## [2,]    4    2</code></pre>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb204-1" title="1"><span class="co"># Potvin &amp; Schutz, 2000, formula 2, p. 348</span></a>
<a class="sourceLine" id="cb204-2" title="2"><span class="co"># For main effect A</span></a>
<a class="sourceLine" id="cb204-3" title="3">lambda_A &lt;-</a>
<a class="sourceLine" id="cb204-4" title="4"><span class="st">  </span>(n <span class="op">*</span><span class="st"> </span>m_A <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((<span class="kw">rowMeans</span>(mean_mat) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb204-5" title="5"><span class="st">                   </span><span class="kw">mean</span>(<span class="kw">rowMeans</span>(mean_mat))) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) ) <span class="op">/</span><span class="st"> </span>variance_e_A</a>
<a class="sourceLine" id="cb204-6" title="6">  lambda_A</a></code></pre></div>
<pre><code>## [1] 7.826087</code></pre>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb206-1" title="1"><span class="co">#calculate degrees of freedom 1 - ignoring the sphericity correction</span></a>
<a class="sourceLine" id="cb206-2" title="2">df1 &lt;-<span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) </a>
<a class="sourceLine" id="cb206-3" title="3"></a>
<a class="sourceLine" id="cb206-4" title="4">df2 &lt;-<span class="st"> </span>(n <span class="op">-</span><span class="st"> </span>k) <span class="op">*</span><span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="co">#calculate degrees of freedom 2</span></a>
<a class="sourceLine" id="cb206-5" title="5"></a>
<a class="sourceLine" id="cb206-6" title="6">F_critical &lt;-<span class="st"> </span><span class="kw">qf</span>(alpha, <span class="co"># critical F-vaue</span></a>
<a class="sourceLine" id="cb206-7" title="7">                 df1,</a>
<a class="sourceLine" id="cb206-8" title="8">                 df2, </a>
<a class="sourceLine" id="cb206-9" title="9">                 <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb206-10" title="10"></a>
<a class="sourceLine" id="cb206-11" title="11">pow_A &lt;-<span class="st"> </span><span class="kw">pf</span>(<span class="kw">qf</span>(alpha, <span class="co">#power </span></a>
<a class="sourceLine" id="cb206-12" title="12">             df1, </a>
<a class="sourceLine" id="cb206-13" title="13">             df2, </a>
<a class="sourceLine" id="cb206-14" title="14">             <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>), </a>
<a class="sourceLine" id="cb206-15" title="15">          df1, </a>
<a class="sourceLine" id="cb206-16" title="16">          df2, </a>
<a class="sourceLine" id="cb206-17" title="17">          lambda_A, </a>
<a class="sourceLine" id="cb206-18" title="18">          <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb206-19" title="19">pow_A<span class="op">*</span><span class="dv">100</span></a></code></pre></div>
<pre><code>## [1] 75.61412</code></pre>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb208-1" title="1">lambda_B &lt;-</a>
<a class="sourceLine" id="cb208-2" title="2"><span class="st">  </span>n <span class="op">*</span><span class="st"> </span>m_B <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((<span class="kw">colMeans</span>(mean_mat) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb208-3" title="3"><span class="st">                   </span><span class="kw">mean</span>(<span class="kw">colMeans</span>(mean_mat))) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>variance_e_B </a>
<a class="sourceLine" id="cb208-4" title="4">lambda_B</a></code></pre></div>
<pre><code>## [1] 7.826087</code></pre>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb210-1" title="1">df1 &lt;-<span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="co">#calculate degrees of freedom 1</span></a>
<a class="sourceLine" id="cb210-2" title="2"></a>
<a class="sourceLine" id="cb210-3" title="3">df2 &lt;-<span class="st"> </span>(n <span class="op">-</span><span class="st"> </span>k) <span class="op">*</span><span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="co">#calculate degrees of freedom 2</span></a>
<a class="sourceLine" id="cb210-4" title="4"></a>
<a class="sourceLine" id="cb210-5" title="5">F_critical &lt;-<span class="st"> </span><span class="kw">qf</span>(alpha, <span class="co"># critical F-vaue</span></a>
<a class="sourceLine" id="cb210-6" title="6">                 df1,</a>
<a class="sourceLine" id="cb210-7" title="7">                 df2,</a>
<a class="sourceLine" id="cb210-8" title="8">                 <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb210-9" title="9"></a>
<a class="sourceLine" id="cb210-10" title="10">pow_B &lt;-<span class="st"> </span><span class="kw">pf</span>(<span class="kw">qf</span>(alpha, <span class="co">#power </span></a>
<a class="sourceLine" id="cb210-11" title="11">             df1, </a>
<a class="sourceLine" id="cb210-12" title="12">             df2, </a>
<a class="sourceLine" id="cb210-13" title="13">             <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>), </a>
<a class="sourceLine" id="cb210-14" title="14">          df1, </a>
<a class="sourceLine" id="cb210-15" title="15">          df2, </a>
<a class="sourceLine" id="cb210-16" title="16">          lambda_B, </a>
<a class="sourceLine" id="cb210-17" title="17">          <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb210-18" title="18"></a>
<a class="sourceLine" id="cb210-19" title="19"></a>
<a class="sourceLine" id="cb210-20" title="20">pow_B<span class="op">*</span><span class="dv">100</span></a></code></pre></div>
<pre><code>## [1] 75.61412</code></pre>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb212-1" title="1"><span class="co">#Peform double summation courtesy of Andrew Vigotsky</span></a>
<a class="sourceLine" id="cb212-2" title="2">term &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb212-3" title="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(mean_mat)) {</a>
<a class="sourceLine" id="cb212-4" title="4">  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(mean_mat)) {</a>
<a class="sourceLine" id="cb212-5" title="5">    term &lt;-<span class="st"> </span>(term <span class="op">+</span><span class="st"> </span>(mean_mat[i,j] <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb212-6" title="6"><span class="st">                       </span><span class="kw">mean</span>(mean_mat[i,]) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb212-7" title="7"><span class="st">                       </span><span class="kw">mean</span>(mean_mat[,j]) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(mean_mat))<span class="op">^</span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb212-8" title="8">  }</a>
<a class="sourceLine" id="cb212-9" title="9">}</a>
<a class="sourceLine" id="cb212-10" title="10">term</a></code></pre></div>
<pre><code>## [1] 0.25</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb214-1" title="1"><span class="co">#Calculate lambda for interaction term</span></a>
<a class="sourceLine" id="cb214-2" title="2">lambda_AB &lt;-<span class="st"> </span>n<span class="op">*</span>term<span class="op">/</span>variance_e_AB</a>
<a class="sourceLine" id="cb214-3" title="3">lambda_AB</a></code></pre></div>
<pre><code>## [1] 0.8695652</code></pre>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb216-1" title="1">df1 &lt;-<span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)  <span class="co">#calculate degrees of freedom 1</span></a>
<a class="sourceLine" id="cb216-2" title="2">df2 &lt;-</a>
<a class="sourceLine" id="cb216-3" title="3">(n <span class="op">-</span><span class="st"> </span>k) <span class="op">*</span><span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="co">#calculate degrees of freedom 2</span></a>
<a class="sourceLine" id="cb216-4" title="4">F_critical &lt;-<span class="st"> </span><span class="kw">qf</span>(alpha, <span class="co"># critical F-vaue</span></a>
<a class="sourceLine" id="cb216-5" title="5">df1,</a>
<a class="sourceLine" id="cb216-6" title="6">df2,</a>
<a class="sourceLine" id="cb216-7" title="7"><span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb216-8" title="8"></a>
<a class="sourceLine" id="cb216-9" title="9">pow_AB &lt;-<span class="st"> </span><span class="kw">pf</span>(<span class="kw">qf</span>(alpha, <span class="co">#power</span></a>
<a class="sourceLine" id="cb216-10" title="10">df1,</a>
<a class="sourceLine" id="cb216-11" title="11">df2,</a>
<a class="sourceLine" id="cb216-12" title="12"><span class="dt">lower.tail =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb216-13" title="13">df1,</a>
<a class="sourceLine" id="cb216-14" title="14">df2,</a>
<a class="sourceLine" id="cb216-15" title="15">lambda_AB,</a>
<a class="sourceLine" id="cb216-16" title="16"><span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb216-17" title="17"></a>
<a class="sourceLine" id="cb216-18" title="18">pow_AB<span class="op">*</span><span class="dv">100</span></a></code></pre></div>
<pre><code>## [1] 14.36376</code></pre>
<p>We can now compile all the analytical results into a single table, and see that the results match those from <code>ANOVA_exact</code>.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-163">Table 3.16: </span>Analytical Result
</caption>
<thead>
<tr>
<th style="text-align:right;">
variance
</th>
<th style="text-align:right;">
lambda
</th>
<th style="text-align:right;">
power
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
5.75
</td>
<td style="text-align:right;">
7.8260870
</td>
<td style="text-align:right;">
75.61412
</td>
</tr>
<tr>
<td style="text-align:right;">
5.75
</td>
<td style="text-align:right;">
7.8260870
</td>
<td style="text-align:right;">
75.61412
</td>
</tr>
<tr>
<td style="text-align:right;">
5.75
</td>
<td style="text-align:right;">
0.8695652
</td>
<td style="text-align:right;">
14.36376
</td>
</tr>
</tbody>
</table>
<p>And we can see in the simple scenario matches <code>ANOVA_exact</code> and <code>ANOVA_power</code> output.</p>
<p>Letâs now extend to one of the simlations presented by <span class="citation">Potvin and Schutz (<a href="#ref-potvin2000statistical">2000</a>)</span> with a 3x3 solution.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb218-1" title="1">mu =<span class="st"> </span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">4</span>,</a>
<a class="sourceLine" id="cb218-2" title="2">       <span class="dv">2</span>,.<span class="dv">5</span>,<span class="dv">3</span>,</a>
<a class="sourceLine" id="cb218-3" title="3">       <span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">6</span>) </a>
<a class="sourceLine" id="cb218-4" title="4">n &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb218-5" title="5">sd &lt;-<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb218-6" title="6">r &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.0</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,</a>
<a class="sourceLine" id="cb218-7" title="7">       <span class="fl">0.8</span>,<span class="fl">1.0</span>,<span class="fl">0.8</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,</a>
<a class="sourceLine" id="cb218-8" title="8">       <span class="fl">0.8</span>,<span class="fl">0.8</span>,<span class="fl">1.0</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,</a>
<a class="sourceLine" id="cb218-9" title="9">       <span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">1.0</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,</a>
<a class="sourceLine" id="cb218-10" title="10">       <span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">1.0</span>,<span class="fl">0.8</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,</a>
<a class="sourceLine" id="cb218-11" title="11">       <span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span>,<span class="fl">1.0</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,</a>
<a class="sourceLine" id="cb218-12" title="12">       <span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">1.0</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb218-13" title="13">       <span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">1.0</span>,<span class="fl">0.8</span>,</a>
<a class="sourceLine" id="cb218-14" title="14">       <span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.4</span>,<span class="fl">0.8</span>,<span class="fl">0.8</span>,<span class="fl">1.0</span>)</a>
<a class="sourceLine" id="cb218-15" title="15"></a>
<a class="sourceLine" id="cb218-16" title="16"></a>
<a class="sourceLine" id="cb218-17" title="17">string =<span class="st"> &quot;3w*3w&quot;</span></a>
<a class="sourceLine" id="cb218-18" title="18">alpha_level &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb218-19" title="19"></a>
<a class="sourceLine" id="cb218-20" title="20">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="dt">design =</span> string,</a>
<a class="sourceLine" id="cb218-21" title="21">                              <span class="dt">n =</span> n, </a>
<a class="sourceLine" id="cb218-22" title="22">                              <span class="dt">mu =</span> mu, </a>
<a class="sourceLine" id="cb218-23" title="23">                              <span class="dt">sd =</span> sd, </a>
<a class="sourceLine" id="cb218-24" title="24">                              <span class="dt">r =</span> r, </a>
<a class="sourceLine" id="cb218-25" title="25">                              <span class="dt">plot =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p><img src="SuperpowerValidation_files/figure-html/unnamed-chunk-164-1.png" width="672" /></p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb219-1" title="1">design_result<span class="op">$</span>cor_mat</a></code></pre></div>
<pre><code>##       a1_b1 a1_b2 a1_b3 a2_b1 a2_b2 a2_b3 a3_b1 a3_b2 a3_b3
## a1_b1   1.0   0.8   0.8   0.4   0.4   0.4   0.4   0.4   0.4
## a1_b2   0.8   1.0   0.8   0.4   0.4   0.4   0.4   0.4   0.4
## a1_b3   0.8   0.8   1.0   0.4   0.4   0.4   0.4   0.4   0.4
## a2_b1   0.4   0.4   0.4   1.0   0.8   0.8   0.4   0.4   0.4
## a2_b2   0.4   0.4   0.4   0.8   1.0   0.8   0.4   0.4   0.4
## a2_b3   0.4   0.4   0.4   0.8   0.8   1.0   0.4   0.4   0.4
## a3_b1   0.4   0.4   0.4   0.4   0.4   0.4   1.0   0.8   0.8
## a3_b2   0.4   0.4   0.4   0.4   0.4   0.4   0.8   1.0   0.8
## a3_b3   0.4   0.4   0.4   0.4   0.4   0.4   0.8   0.8   1.0</code></pre>
<p>The design now matches the correlation matrix in Figure 1 of <span class="citation">Potvin and Schutz (<a href="#ref-potvin2000statistical">2000</a>)</span>.</p>
<p>And we can estimate power with <code>ANOVA_exact</code>.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb221-1" title="1">exact_result &lt;-<span class="st"> </span><span class="kw">ANOVA_exact</span>(design_result,</a>
<a class="sourceLine" id="cb221-2" title="2">                            <span class="dt">alpha_level =</span> alpha_level,</a>
<a class="sourceLine" id="cb221-3" title="3">                            <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-166">Table 3.17: </span>Exact ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
partial_eta_squared
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
a
</td>
<td style="text-align:right;">
9.441726
</td>
<td style="text-align:right;">
0.0156250
</td>
<td style="text-align:right;">
0.1259882
</td>
<td style="text-align:right;">
0.6031746
</td>
</tr>
<tr>
<td style="text-align:left;">
b
</td>
<td style="text-align:right;">
100.000000
</td>
<td style="text-align:right;">
0.7020906
</td>
<td style="text-align:right;">
1.5351629
</td>
<td style="text-align:right;">
89.5555556
</td>
</tr>
<tr>
<td style="text-align:left;">
a:b
</td>
<td style="text-align:right;">
90.092634
</td>
<td style="text-align:right;">
0.1778846
</td>
<td style="text-align:right;">
0.4651605
</td>
<td style="text-align:right;">
16.4444444
</td>
</tr>
</tbody>
</table>
<p>Further, as we use the analytical solution below, the variance components should be equal to the corresponding MSE from the <code>ANOVA_exact</code> produced <code>anova_table</code> object.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb222-1" title="1">exact_result<span class="op">$</span>aov_result<span class="op">$</span>anova_table</a></code></pre></div>
<pre><code>## Anova Table (Type 3 tests)
## 
## Response: y
##     num Df den Df MSE       F     pes          Pr(&gt;F)    
## a        2     38  35  0.3016 0.01563        0.741397    
## b        2     38   5 44.7778 0.70209 0.0000000001018 ***
## a:b      4     76   5  4.1111 0.17788        0.004542 ** 
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb224-1" title="1">k &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co">#one group (because all factors are within)</span></a>
<a class="sourceLine" id="cb224-2" title="2"></a>
<a class="sourceLine" id="cb224-3" title="3">rho_A &lt;-<span class="st"> </span><span class="fl">.4</span> <span class="co">#mean r for factor A</span></a>
<a class="sourceLine" id="cb224-4" title="4"></a>
<a class="sourceLine" id="cb224-5" title="5">rho_B &lt;-<span class="st"> </span><span class="fl">.8</span> <span class="co">#mean r for factor B</span></a>
<a class="sourceLine" id="cb224-6" title="6"></a>
<a class="sourceLine" id="cb224-7" title="7">rho_AB &lt;-<span class="st"> </span><span class="fl">.4</span> <span class="co">#mean r for factor AB</span></a>
<a class="sourceLine" id="cb224-8" title="8"></a>
<a class="sourceLine" id="cb224-9" title="9">alpha &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb224-10" title="10"></a>
<a class="sourceLine" id="cb224-11" title="11">sigma &lt;-<span class="st"> </span>sd</a>
<a class="sourceLine" id="cb224-12" title="12"></a>
<a class="sourceLine" id="cb224-13" title="13">m_A &lt;-<span class="st"> </span><span class="dv">3</span> <span class="co">#levels factor A</span></a>
<a class="sourceLine" id="cb224-14" title="14"></a>
<a class="sourceLine" id="cb224-15" title="15">variance_e_A &lt;-<span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rho_A) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb224-16" title="16"><span class="st">  </span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(rho_B <span class="op">-</span><span class="st"> </span>rho_AB) </a>
<a class="sourceLine" id="cb224-17" title="17"><span class="co">#Variance A</span></a>
<a class="sourceLine" id="cb224-18" title="18">variance_e_A</a></code></pre></div>
<pre><code>## [1] 35</code></pre>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb226-1" title="1">m_B &lt;-<span class="st"> </span><span class="dv">3</span> <span class="co">#levels factor B</span></a>
<a class="sourceLine" id="cb226-2" title="2"></a>
<a class="sourceLine" id="cb226-3" title="3">variance_e_B &lt;-<span class="st"> </span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>rho_B) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb226-4" title="4"><span class="st">  </span>sigma<span class="op">^</span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(rho_A <span class="op">-</span><span class="st"> </span>rho_AB)</a>
<a class="sourceLine" id="cb226-5" title="5"><span class="co">#Variance B</span></a>
<a class="sourceLine" id="cb226-6" title="6">variance_e_B</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb228-1" title="1">variance_e_AB &lt;-</a>
<a class="sourceLine" id="cb228-2" title="2"><span class="st">  </span>(sigma <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">max</span>(rho_A, rho_B)) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb228-3" title="3"><span class="st">     </span>sigma <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>(<span class="kw">min</span>(rho_A,rho_B) <span class="op">-</span><span class="st"> </span>rho_AB)) </a>
<a class="sourceLine" id="cb228-4" title="4"><span class="co">#Variance AB</span></a>
<a class="sourceLine" id="cb228-5" title="5">variance_e_AB</a></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb230"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb230-1" title="1"><span class="co">#Create a mean matrix</span></a>
<a class="sourceLine" id="cb230-2" title="2">mean_mat &lt;-<span class="st"> </span><span class="kw">t</span>(<span class="kw">matrix</span>(mu, <span class="dt">nrow =</span> m_B,<span class="dt">ncol =</span> m_A)) </a>
<a class="sourceLine" id="cb230-3" title="3">mean_mat</a></code></pre></div>
<pre><code>##      [,1] [,2] [,3]
## [1,]    2  1.0    4
## [2,]    2  0.5    3
## [3,]    2  0.0    6</code></pre>
<div class="sourceCode" id="cb232"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb232-1" title="1"><span class="co"># Potvin &amp; Schutz, 2000, formula 2, p. 348</span></a>
<a class="sourceLine" id="cb232-2" title="2"><span class="co"># For main effect A</span></a>
<a class="sourceLine" id="cb232-3" title="3">lambda_A &lt;-</a>
<a class="sourceLine" id="cb232-4" title="4"><span class="st">  </span>(n <span class="op">*</span><span class="st"> </span>m_A <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((<span class="kw">rowMeans</span>(mean_mat) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb232-5" title="5"><span class="st">                   </span><span class="kw">mean</span>(<span class="kw">rowMeans</span>(mean_mat))) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) ) <span class="op">/</span><span class="st"> </span>variance_e_A</a>
<a class="sourceLine" id="cb232-6" title="6">  lambda_A</a></code></pre></div>
<pre><code>## [1] 0.6031746</code></pre>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb234-1" title="1"><span class="co">#calculate degrees of freedom 1 - ignoring the sphericity correction</span></a>
<a class="sourceLine" id="cb234-2" title="2">df1 &lt;-<span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) </a>
<a class="sourceLine" id="cb234-3" title="3"></a>
<a class="sourceLine" id="cb234-4" title="4">df2 &lt;-<span class="st"> </span>(n <span class="op">-</span><span class="st"> </span>k) <span class="op">*</span><span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="co">#calculate degrees of freedom 2</span></a>
<a class="sourceLine" id="cb234-5" title="5"></a>
<a class="sourceLine" id="cb234-6" title="6">F_critical &lt;-<span class="st"> </span><span class="kw">qf</span>(alpha, <span class="co"># critical F-vaue</span></a>
<a class="sourceLine" id="cb234-7" title="7">                 df1,</a>
<a class="sourceLine" id="cb234-8" title="8">                 df2, </a>
<a class="sourceLine" id="cb234-9" title="9">                 <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb234-10" title="10"></a>
<a class="sourceLine" id="cb234-11" title="11">pow_A &lt;-<span class="st"> </span><span class="kw">pf</span>(<span class="kw">qf</span>(alpha, <span class="co">#power </span></a>
<a class="sourceLine" id="cb234-12" title="12">             df1, </a>
<a class="sourceLine" id="cb234-13" title="13">             df2, </a>
<a class="sourceLine" id="cb234-14" title="14">             <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>), </a>
<a class="sourceLine" id="cb234-15" title="15">          df1, </a>
<a class="sourceLine" id="cb234-16" title="16">          df2, </a>
<a class="sourceLine" id="cb234-17" title="17">          lambda_A, </a>
<a class="sourceLine" id="cb234-18" title="18">          <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb234-19" title="19">pow_A<span class="op">*</span><span class="dv">100</span></a></code></pre></div>
<pre><code>## [1] 9.441726</code></pre>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb236-1" title="1">lambda_B &lt;-</a>
<a class="sourceLine" id="cb236-2" title="2"><span class="st">  </span>n <span class="op">*</span><span class="st"> </span>m_B <span class="op">*</span><span class="st"> </span><span class="kw">sum</span>((<span class="kw">colMeans</span>(mean_mat) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb236-3" title="3"><span class="st">                   </span><span class="kw">mean</span>(<span class="kw">colMeans</span>(mean_mat))) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>variance_e_B </a>
<a class="sourceLine" id="cb236-4" title="4">lambda_B</a></code></pre></div>
<pre><code>## [1] 89.55556</code></pre>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb238-1" title="1">df1 &lt;-<span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="co">#calculate degrees of freedom 1</span></a>
<a class="sourceLine" id="cb238-2" title="2"></a>
<a class="sourceLine" id="cb238-3" title="3">df2 &lt;-<span class="st"> </span>(n <span class="op">-</span><span class="st"> </span>k) <span class="op">*</span><span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="co">#calculate degrees of freedom 2</span></a>
<a class="sourceLine" id="cb238-4" title="4"></a>
<a class="sourceLine" id="cb238-5" title="5">F_critical &lt;-<span class="st"> </span><span class="kw">qf</span>(alpha, <span class="co"># critical F-vaue</span></a>
<a class="sourceLine" id="cb238-6" title="6">                 df1,</a>
<a class="sourceLine" id="cb238-7" title="7">                 df2,</a>
<a class="sourceLine" id="cb238-8" title="8">                 <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) </a>
<a class="sourceLine" id="cb238-9" title="9"></a>
<a class="sourceLine" id="cb238-10" title="10">pow_B &lt;-<span class="st"> </span><span class="kw">pf</span>(<span class="kw">qf</span>(alpha, <span class="co">#power </span></a>
<a class="sourceLine" id="cb238-11" title="11">             df1, </a>
<a class="sourceLine" id="cb238-12" title="12">             df2, </a>
<a class="sourceLine" id="cb238-13" title="13">             <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>), </a>
<a class="sourceLine" id="cb238-14" title="14">          df1, </a>
<a class="sourceLine" id="cb238-15" title="15">          df2, </a>
<a class="sourceLine" id="cb238-16" title="16">          lambda_B, </a>
<a class="sourceLine" id="cb238-17" title="17">          <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb238-18" title="18"></a>
<a class="sourceLine" id="cb238-19" title="19"></a>
<a class="sourceLine" id="cb238-20" title="20">pow_B<span class="op">*</span><span class="dv">100</span></a></code></pre></div>
<pre><code>## [1] 100</code></pre>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb240-1" title="1"><span class="co">#Peform double summation courtesy of Andrew Vigotsky</span></a>
<a class="sourceLine" id="cb240-2" title="2">term &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb240-3" title="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(mean_mat)) {</a>
<a class="sourceLine" id="cb240-4" title="4">  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(mean_mat)) {</a>
<a class="sourceLine" id="cb240-5" title="5">    term &lt;-<span class="st"> </span>((term <span class="op">+</span><span class="st"> </span>(mean_mat[i,j] <span class="op">-</span></a>
<a class="sourceLine" id="cb240-6" title="6"><span class="st">                        </span><span class="kw">mean</span>(mean_mat[i,]) <span class="op">-</span><span class="st"> </span></a>
<a class="sourceLine" id="cb240-7" title="7"><span class="st">                        </span><span class="kw">mean</span>(mean_mat[,j]) <span class="op">+</span><span class="st"> </span><span class="kw">mean</span>(mean_mat))<span class="op">^</span><span class="dv">2</span>))</a>
<a class="sourceLine" id="cb240-8" title="8">  }</a>
<a class="sourceLine" id="cb240-9" title="9">}</a>
<a class="sourceLine" id="cb240-10" title="10">term</a></code></pre></div>
<pre><code>## [1] 4.111111</code></pre>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb242-1" title="1"><span class="co">#Calculate lambda for interaction term</span></a>
<a class="sourceLine" id="cb242-2" title="2">lambda_AB &lt;-<span class="st"> </span>n<span class="op">*</span>term<span class="op">/</span>variance_e_AB</a>
<a class="sourceLine" id="cb242-3" title="3">lambda_AB</a></code></pre></div>
<pre><code>## [1] 16.44444</code></pre>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb244-1" title="1">df1 &lt;-<span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>)  <span class="co">#calculate degrees of freedom 1</span></a>
<a class="sourceLine" id="cb244-2" title="2">df2 &lt;-</a>
<a class="sourceLine" id="cb244-3" title="3">(n <span class="op">-</span><span class="st"> </span>k) <span class="op">*</span><span class="st"> </span>(m_A <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>(m_B <span class="op">-</span><span class="st"> </span><span class="dv">1</span>) <span class="co">#calculate degrees of freedom 2</span></a>
<a class="sourceLine" id="cb244-4" title="4">F_critical &lt;-<span class="st"> </span><span class="kw">qf</span>(alpha, <span class="co"># critical F-vaue</span></a>
<a class="sourceLine" id="cb244-5" title="5">df1,</a>
<a class="sourceLine" id="cb244-6" title="6">df2,</a>
<a class="sourceLine" id="cb244-7" title="7"><span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb244-8" title="8"></a>
<a class="sourceLine" id="cb244-9" title="9">pow_AB &lt;-<span class="st"> </span><span class="kw">pf</span>(<span class="kw">qf</span>(alpha, <span class="co">#power</span></a>
<a class="sourceLine" id="cb244-10" title="10">df1,</a>
<a class="sourceLine" id="cb244-11" title="11">df2,</a>
<a class="sourceLine" id="cb244-12" title="12"><span class="dt">lower.tail =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb244-13" title="13">df1,</a>
<a class="sourceLine" id="cb244-14" title="14">df2,</a>
<a class="sourceLine" id="cb244-15" title="15">lambda_AB,</a>
<a class="sourceLine" id="cb244-16" title="16"><span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb244-17" title="17"></a>
<a class="sourceLine" id="cb244-18" title="18">pow_AB<span class="op">*</span><span class="dv">100</span></a></code></pre></div>
<pre><code>## [1] 90.09263</code></pre>
<p>Again, when we compile all the analytical results into a single table we can see that the results match those from <code>ANOVA_exact</code>.</p>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-170">Table 3.18: </span>Analytical Result
</caption>
<thead>
<tr>
<th style="text-align:right;">
variance
</th>
<th style="text-align:right;">
lambda
</th>
<th style="text-align:right;">
power
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
0.6031746
</td>
<td style="text-align:right;">
9.441726
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
89.5555556
</td>
<td style="text-align:right;">
100.000000
</td>
</tr>
<tr>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
16.4444444
</td>
<td style="text-align:right;">
90.092634
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="multivariate-anova-manova" class="section level2">
<h2><span class="header-section-number">3.6</span> Multivariate ANOVA (MANOVA)</h2>
<p>A large proportion of research with within-subjects manipulations, or repeated measures, rely upon the âunivariateâ approach <span class="citation">(Maxwell et al. <a href="#ref-maxwell_designing_2004">2004</a>)</span>. While this approach is valid, when corrections for sphercity are applied, it may not be the most powerful or informative analysis plan. Instead, researchers should consider a multivariate analysis (MANOVA). While the MANOVA is not âassumption freeâ it does not assume sphercity which makes it a very attractive analytical tool and the preferred method of analysis for some [<span class="citation">Maxwell et al. (<a href="#ref-maxwell_designing_2004">2004</a>)</span>.</p>
<p>For a simple one-way repeated measures design, there are some simple guidelines for power analysis set forth by <span class="citation">Maxwell et al. (<a href="#ref-maxwell_designing_2004">2004</a>)</span> (pg. 750). All that is needed in the effect size calculated as:
<span class="math display">\[ d = \frac{\mu_{max}-\mu_{min}}{\sigma} \]</span>
This assumes that each level has a common standard deviation (i.e., there is only 1 <code>sd</code> input for the design).</p>
<p>In addition, the non-centrality parameter of the <em>F</em>-statistic can be estimated from <span class="citation">Vonesh and Schork (<a href="#ref-vonesh1986sample">1986</a>)</span> equations as the following:
<span class="math display">\[ \delta^2 = \frac{n \cdot d^2}{2\cdot(1-\rho_{min} )} \]</span></p>
<p>Let us assume we have a <code>2w</code> design with <code>mu = c(0,0.5)</code>, a common standard deviation of 1 (<code>sd=1</code>), and correlation between <code>a1</code> and <code>a2</code> of <code>r</code> <code>= .4</code> and a total sample size of 15 (<code>n = 15</code>) participants.
Power could then be calculated with the following <code>R</code> code.</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb246-1" title="1">mu =<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb246-2" title="2">rho =<span class="st"> </span><span class="fl">.4</span></a>
<a class="sourceLine" id="cb246-3" title="3">sd =<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb246-4" title="4">n =<span class="st"> </span><span class="dv">15</span></a>
<a class="sourceLine" id="cb246-5" title="5">d =<span class="st"> </span>(<span class="kw">max</span>(mu)<span class="op">-</span><span class="kw">min</span>(mu))<span class="op">/</span>sd</a>
<a class="sourceLine" id="cb246-6" title="6">noncentrality =<span class="st"> </span>((n<span class="op">*</span>d<span class="op">^</span><span class="dv">2</span>) <span class="op">/</span><span class="st"> </span>(<span class="dv">2</span><span class="op">*</span>(<span class="dv">1</span><span class="op">-</span><span class="kw">min</span>(rho))))</a>
<a class="sourceLine" id="cb246-7" title="7">noncentrality</a></code></pre></div>
<pre><code>## [1] 0.78125</code></pre>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb248-1" title="1"><span class="co">#Critical F</span></a>
<a class="sourceLine" id="cb248-2" title="2">Ft &lt;-<span class="st"> </span><span class="kw">qf</span>((<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="fl">.05</span>), <span class="dv">1</span>, <span class="dv">14</span>)</a>
<a class="sourceLine" id="cb248-3" title="3">Ft</a></code></pre></div>
<pre><code>## [1] 4.60011</code></pre>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb250-1" title="1"><span class="co">#Power</span></a>
<a class="sourceLine" id="cb250-2" title="2">power &lt;-<span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span><span class="kw">pf</span>(Ft,</a>
<a class="sourceLine" id="cb250-3" title="3">                 <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb250-4" title="4">                 <span class="dv">14</span>,</a>
<a class="sourceLine" id="cb250-5" title="5">                 noncentrality)) <span class="op">*</span><span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb250-6" title="6">power</a></code></pre></div>
<pre><code>## [1] 13.07682</code></pre>

<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb252-1" title="1">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="st">&quot;2w&quot;</span>,</a>
<a class="sourceLine" id="cb252-2" title="2">                              <span class="dt">n =</span> n,</a>
<a class="sourceLine" id="cb252-3" title="3">                              <span class="dt">r =</span> rho,</a>
<a class="sourceLine" id="cb252-4" title="4">                              <span class="dt">sd =</span> sd,</a>
<a class="sourceLine" id="cb252-5" title="5">                              <span class="dt">mu =</span> mu)</a>
<a class="sourceLine" id="cb252-6" title="6"></a>
<a class="sourceLine" id="cb252-7" title="7">exact_result &lt;-<span class="st"> </span><span class="kw">ANOVA_exact</span>(design_result, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-174">Table 3.19: </span>MANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
pillai_trace
</th>
<th style="text-align:right;">
cohen_f
</th>
<th style="text-align:right;">
non_centrality
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
8.401182
</td>
<td style="text-align:right;">
0.0233572
</td>
<td style="text-align:right;">
0.1546474
</td>
<td style="text-align:right;">
0.3348214
</td>
</tr>
<tr>
<td style="text-align:left;">
a
</td>
<td style="text-align:right;">
13.076818
</td>
<td style="text-align:right;">
0.0528541
</td>
<td style="text-align:right;">
0.2362278
</td>
<td style="text-align:right;">
0.7812500
</td>
</tr>
</tbody>
</table>
<p>The problem with this formula for determining power is that it is inexact and makes a number of assumptions (<span class="citation">Maxwell et al. (<a href="#ref-maxwell_designing_2004">2004</a>)</span>, ppg. 752). In reality, it can only give a lower bound estimate of power for a given design, and the actual power may be much higher. This is problematic because it could lead to inefficient study design (e.g., determining you need 20 participants when adequate power could be achieved with less participants). This will become increasingly important with designs with multiple levels and possible violations of the assumption of sphericity.</p>
</div>
<div id="sphericity-assumption" class="section level2">
<h2><span class="header-section-number">3.7</span> Sphericity Assumption</h2>
<p>In all the above examples, you will notice that the correlation is the sample between repeated measures. For most experiments in real life, this will not be the case. The correlations between levels may vary. This is problematic because the univariate (ANOVA) approach assumes sphericity, which means, for all intents and purposes, that the correlations between factor-levels are equal and the standard deviations at each level are equal as well. This assumption is tenuous at best and is typically âadjustedâ for by applying a sphericity correction (e.g, Greenhouse-Geisser). How bad can it get? Well, letâs simulate an example below.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb253-1" title="1">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="st">&quot;4w&quot;</span>,</a>
<a class="sourceLine" id="cb253-2" title="2">                              <span class="dt">n =</span> <span class="dv">29</span>,</a>
<a class="sourceLine" id="cb253-3" title="3">                              <span class="dt">r =</span> <span class="kw">c</span>(.<span class="dv">05</span>,.<span class="dv">15</span>,.<span class="dv">25</span>,.<span class="dv">55</span>, <span class="fl">.65</span>, <span class="fl">.9</span></a>
<a class="sourceLine" id="cb253-4" title="4">                                    ),</a>
<a class="sourceLine" id="cb253-5" title="5">                              <span class="dt">sd =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb253-6" title="6">                              <span class="dt">mu=</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb253-7" title="7"></a>
<a class="sourceLine" id="cb253-8" title="8"><span class="co">#In order to simulate violations we MUST use ANOVA_power</span></a>
<a class="sourceLine" id="cb253-9" title="9">power_result_s1 &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, <span class="dt">nsims =</span> nsims, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-175">Table 3.20: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_a
</td>
<td style="text-align:right;">
7.16
</td>
<td style="text-align:right;">
0.0344525
</td>
</tr>
</tbody>
</table>
<p><strong>INSERT ANOVA Result ABOUT HERE</strong></p>
<p>As we can see, the actual type I error rate far exceeds the typical 5%!</p>
<p>Now, letâs pour gasoline on the fire and see what happens when we make the sphericity violation worse by varying the standard deviations.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb254-1" title="1">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="st">&quot;4w&quot;</span>,</a>
<a class="sourceLine" id="cb254-2" title="2">                              <span class="dt">n =</span> <span class="dv">29</span>,</a>
<a class="sourceLine" id="cb254-3" title="3">                              <span class="dt">r =</span> <span class="kw">c</span>(.<span class="dv">05</span>,.<span class="dv">15</span>,.<span class="dv">25</span>,.<span class="dv">55</span>, <span class="fl">.65</span>, <span class="fl">.9</span></a>
<a class="sourceLine" id="cb254-4" title="4">                                    ),</a>
<a class="sourceLine" id="cb254-5" title="5">                              <span class="dt">sd =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>),</a>
<a class="sourceLine" id="cb254-6" title="6">                              <span class="dt">mu=</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb254-7" title="7"></a>
<a class="sourceLine" id="cb254-8" title="8"><span class="co">#In order to simulate violations we MUST use ANOVA_power</span></a>
<a class="sourceLine" id="cb254-9" title="9">power_result_s2 &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, <span class="dt">nsims =</span> nsims, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-177">Table 3.21: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_a
</td>
<td style="text-align:right;">
8.37
</td>
<td style="text-align:right;">
0.0346856
</td>
</tr>
</tbody>
</table>
<p><strong>INSERT ANOVA Result ABOUT HERE</strong></p>
<p>These inflated error rates are obviously a problem, which begs the question what do we do about them?</p>
<p>In our experience, most researchers default to using a Greenhouse-Geisser adjustment for sphericity, but this may not be the most statistical efficient way of dealing with violations of sphercity. Further, as we can see from the simulation (<code>power_result_s2</code>) the MANOVA maintains the type I error rate at 5%.</p>
<p><strong>Insert MANOVA Result About HERE</strong></p>
<div id="manova-or-sphericity-adjustment" class="section level3">
<h3><span class="header-section-number">3.7.1</span> MANOVA or Sphericity Adjustment?</h3>
<p>In addition to adjusting for sphericity, one could also simply use the multivariate approach to repeated measures.
While it is tempting to simply say one approach is superior to another, that is not case when the sample size is small (<span class="citation">Maxwell et al. (<a href="#ref-maxwell_designing_2004">2004</a>)</span>, ppg 775). Some general guidelines were proposed by Algina and Keselman (1997):</p>
<p>MANOVA when <code>levels &lt;= 4, epsilon &lt;= .9, n &gt; levels + 15</code> and <code>5 &lt;= levels &lt;= 8, epsilon &lt;= .85, n &gt; levels + 30</code>.</p>
<p>However, <code>ANOVA_power</code> can make the solution easy. Simply simulate, like we have done above, for both the null situation (no differences) and with the hypothesized effect (to determine power), and see which approach best balances type I and II error rates.</p>
<p>As we saw above, the unadjusted repeated measures ANOVA has an elevated type I error rate, but the MANOVA analysis of the same data above approximately preserves the type I error rate. However, how does this perform relative to the sphericity corrections? Letâs simulate again, and compare the results of the different corrections.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb255-1" title="1">design_result &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="st">&quot;4w&quot;</span>,</a>
<a class="sourceLine" id="cb255-2" title="2">                              <span class="dt">n =</span> <span class="dv">29</span>,</a>
<a class="sourceLine" id="cb255-3" title="3">                              <span class="dt">r =</span> <span class="kw">c</span>(.<span class="dv">05</span>,.<span class="dv">15</span>,.<span class="dv">25</span>,.<span class="dv">55</span>, <span class="fl">.65</span>, <span class="fl">.9</span></a>
<a class="sourceLine" id="cb255-4" title="4">                              ),</a>
<a class="sourceLine" id="cb255-5" title="5">                              <span class="dt">sd =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>),</a>
<a class="sourceLine" id="cb255-6" title="6">                              <span class="dt">mu=</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb255-7" title="7"></a>
<a class="sourceLine" id="cb255-8" title="8">power_result_none &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, <span class="dt">nsims =</span> nsims, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-179">Table 3.22: </span>Simulated MANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
manova_(Intercept)
</td>
<td style="text-align:right;">
5.16
</td>
</tr>
<tr>
<td style="text-align:left;">
manova_a
</td>
<td style="text-align:right;">
5.16
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb256-1" title="1">power_result_gg &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, <span class="dt">correction =</span> <span class="st">&quot;GG&quot;</span>,</a>
<a class="sourceLine" id="cb256-2" title="2">                               <span class="dt">nsims =</span> nsims, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-181">Table 3.23: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_a
</td>
<td style="text-align:right;">
4.59
</td>
<td style="text-align:right;">
0.0339026
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb257-1" title="1">power_result_hf &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result, <span class="dt">correction =</span> <span class="st">&quot;HF&quot;</span>,</a>
<a class="sourceLine" id="cb257-2" title="2">                               <span class="dt">nsims =</span> nsims, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-183">Table 3.24: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_a
</td>
<td style="text-align:right;">
5.12
</td>
<td style="text-align:right;">
0.0346905
</td>
</tr>
</tbody>
</table>
<p>Both the sphericity corrections, Greenhouse-Geisser (<code>GG</code>) and Huynh-Feldt (<code>HF</code>), as well as the MANOVA were able to adequately control type I error rate. Howevever, Greenhouse-Geisser seemed to be a tad conservative. We can now directly compare the power of the MANOVA or <code>HF</code>-adjusted approach. We can adjust the study design to the alternative, or hypothesized, model with the predicted means of <code>0, 0.75, 1.5, 3</code> instead of the null model.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb258-1" title="1">design_result_power &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="st">&quot;4w&quot;</span>,</a>
<a class="sourceLine" id="cb258-2" title="2">                              <span class="dt">n =</span> <span class="dv">29</span>,</a>
<a class="sourceLine" id="cb258-3" title="3">                              <span class="dt">r =</span> <span class="kw">c</span>(.<span class="dv">05</span>,.<span class="dv">15</span>,.<span class="dv">25</span>,.<span class="dv">55</span>, <span class="fl">.65</span>, <span class="fl">.9</span></a>
<a class="sourceLine" id="cb258-4" title="4">                              ),</a>
<a class="sourceLine" id="cb258-5" title="5">                              <span class="dt">sd =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>),</a>
<a class="sourceLine" id="cb258-6" title="6">                              <span class="dt">mu=</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.75</span>,<span class="fl">1.5</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb258-7" title="7"></a>
<a class="sourceLine" id="cb258-8" title="8">power_result_hfeffect &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result_power, <span class="dt">correction =</span> <span class="st">&quot;HF&quot;</span>,</a>
<a class="sourceLine" id="cb258-9" title="9">                                     <span class="dt">nsims =</span> nsims, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-185">Table 3.25: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_a
</td>
<td style="text-align:right;">
60.48
</td>
<td style="text-align:right;">
0.1479382
</td>
</tr>
</tbody>
</table>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-186">Table 3.26: </span>Simulated MANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
manova_(Intercept)
</td>
<td style="text-align:right;">
49.60
</td>
</tr>
<tr>
<td style="text-align:left;">
manova_a
</td>
<td style="text-align:right;">
49.64
</td>
</tr>
</tbody>
</table>
<p>Well, it appears the MANOVA based approach has roughly ~10% lower power compared the <code>HF</code>-adjusted ANOVA. However, the study still appears to be underpowered so we can increase the sample size. We will continue to evaluate the MANOVA results because, as <span class="citation">Algina and Keselman (<a href="#ref-algina1997detecting">1997</a>)</span> note, the power disadvantage of MANOVA is diminished with increased sample size.</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb259-1" title="1">design_result_power &lt;-<span class="st"> </span><span class="kw">ANOVA_design</span>(<span class="st">&quot;4w&quot;</span>,</a>
<a class="sourceLine" id="cb259-2" title="2">                              <span class="dt">n =</span> <span class="dv">29</span>,</a>
<a class="sourceLine" id="cb259-3" title="3">                              <span class="dt">r =</span> <span class="kw">c</span>(.<span class="dv">05</span>,.<span class="dv">15</span>,.<span class="dv">25</span>,.<span class="dv">55</span>, <span class="fl">.65</span>, <span class="fl">.9</span>),</a>
<a class="sourceLine" id="cb259-4" title="4">                              <span class="dt">sd =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>),</a>
<a class="sourceLine" id="cb259-5" title="5">                              <span class="dt">mu=</span> <span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.75</span>,<span class="fl">1.5</span>,<span class="dv">3</span>))</a>
<a class="sourceLine" id="cb259-6" title="6"></a>
<a class="sourceLine" id="cb259-7" title="7">power_result_hfeffect &lt;-<span class="st"> </span><span class="kw">ANOVA_power</span>(design_result_power, <span class="dt">correction =</span> <span class="st">&quot;HF&quot;</span>,</a>
<a class="sourceLine" id="cb259-8" title="8">                                     <span class="dt">nsims =</span> nsims, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-188">Table 3.27: </span>Simulated ANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
<th style="text-align:right;">
effect_size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
anova_a
</td>
<td style="text-align:right;">
84.69
</td>
<td style="text-align:right;">
0.1385088
</td>
</tr>
</tbody>
</table>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-189">Table 3.28: </span>Simulated MANOVA Result
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
power
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
manova_(Intercept)
</td>
<td style="text-align:right;">
74.11
</td>
</tr>
<tr>
<td style="text-align:left;">
manova_a
</td>
<td style="text-align:right;">
79.18
</td>
</tr>
</tbody>
</table>
<p>Again, the <code>HF</code>-adjusted analysis appears to be more powerful for <em>this very specific experimental design</em>. The difference in power between univariate and multivariate ouput is diminished when the sample size is increased.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-algina1997detecting">
<p>Algina, James, and HJ Keselman. 1997. âDetecting Repeated Measures Effects with Univariate and Multivariate Statistics.â <em>Psychological Methods</em> 2 (2): 208.</p>
</div>
<div id="ref-cohen1988spa">
<p>Cohen, J. 1988. <em>Statistical Power Analysis for the Behavioral Sciences</em>. Lawrence Erlbaum Associates.</p>
</div>
<div id="ref-faul2007g">
<p>Faul, Franz, Edgar Erdfelder, Albert-Georg Lang, and Axel Buchner. 2007. âG*Power 3: A Flexible Statistical Power Analysis Program for the Social, Behavioral, and Biomedical Sciences.â <em>Behavior Research Methods</em> 39 (2): 175â91. <a href="http://www.psychologie.hhu.de/arbeitsgruppen/allgemeine-psychologie-und-arbeitspsychologie/gpower.html">http://www.psychologie.hhu.de/arbeitsgruppen/allgemeine-psychologie-und-arbeitspsychologie/gpower.html</a>.</p>
</div>
<div id="ref-maxwell_designing_2004">
<p>Maxwell, S.E., S.E. Maxwell, H.D. Delaney, and K. Kelley. 2004. <em>Designing Experiments and Analyzing Data: A Model Comparison Perspective</em>. Avec CD, v. 1. Lawrence Erlbaum Associates. <a href="https://designingexperiments.com/">https://designingexperiments.com/</a>.</p>
</div>
<div id="ref-potvin2000statistical">
<p>Potvin, Patrick J, and Robert W Schutz. 2000. âStatistical Power for the Two-Factor Repeated Measures Anova.â <em>Behavior Research Methods, Instruments, &amp; Computers</em> 32 (2): 347â56. <a href="https://psycnet.apa.org/doi/10.3758/BF03207805">https://psycnet.apa.org/doi/10.3758/BF03207805</a>.</p>
</div>
<div id="ref-vonesh1986sample">
<p>Vonesh, Edward F, and M Anthony Schork. 1986. âSample Sizes in the Multivariate Analysis of Repeated Measurements.â <em>Biometrics</em>, 601â10.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="one-way-anova.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mixed-anova.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["SuperpowerValidation.pdf", "SuperpowerValidation.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
